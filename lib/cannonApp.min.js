function CannonDemo(){"use strict";function a(){var a=e.outputContainer.clientWidth,b=e.outputContainer.clientHeight,c=window.devicePixelRatio||1,d=a*c,g=b*c,h=d;f.domElement.style.width=px(a),f.domElement.style.height=px(b),f.domElement.width=d,f.domElement.height=g,f.setViewport(0,0,d,g),i.aspect=h/g,i.updateProjectionMatrix()}function b(a){a=.001*a,requestAnimationFrame(b),d&&c(a-d),f.render(g,i),d=a}function c(a){j.rotation.set(0,.001*d,0),h.step(a);for(var b=0;b<h.bodies.length;++b){var c=h.bodies[b];c.graphics.position.copy(c.position),c.graphics.quaternion.copy(c.quaternion)}}var d,e=findEverything(),f=new THREE.WebGLRenderer({canvas:e.output,alpha:!0,antialias:!0}),g=new THREE.Scene,h=new CANNON.World,i=put(new THREE.PerspectiveCamera(50,e.output.width/e.output.height,.1,1e3)).on(g).at(0,2,10),j=put(textured(shell(50,8,4,2*Math.PI,Math.PI),"/images/bg2.jpg",!0)).on(g).at(0,0,0),k=1,l=1,m=put(textured(sphere(l,10,20),ROCK,!0,1,k)).on(g,h).at(-5,5,0),n=put(textured(box(10,1,10),DECK,!0,1,0,10,10)).on(g,h).at(0,-1,0),o=new CANNON.ContactMaterial(m.physics.material,n.physics.material,{friction:.4,restitution:.3,contactEquationStiffness:1e8,contactEquationRelaxation:3,frictionEquationStiffness:1e8,frictionEquationRegularizationTime:3});h.defaultContactMaterial.friction=.2,h.gravity.set(0,-9.82,0),h.broadphase=new CANNON.SAPBroadphase(h),h.addContactMaterial(o),m.physics.velocity.set(4,0,0),window.addEventListener("resize",a),a(),requestAnimationFrame(b)}function put(a){return{on:function(b,c){return b.add(a),c&&a.physics&&c.add(a.physics),{at:function(b,c,d){return a.position.set(b,c,d),a.physics&&a.physics.position.set(b,c,d),a}}}}}function textured(a,b,c,d,e,f,g){var h;if(void 0===d&&(d=1),"number"==typeof b)h=c?new THREE.MeshBasicMaterial({transparent:!0,color:b,opacity:d,shading:THREE.FlatShading}):new THREE.MeshLambertMaterial({transparent:!0,color:b,opacity:d});else{var i;i="string"==typeof b?THREE.ImageUtils.loadTexture(b):b,h=c?new THREE.MeshBasicMaterial({color:16777215,map:i,transparent:!0,shading:THREE.FlatShading,side:THREE.DoubleSide,opacity:d}):new THREE.MeshLambertMaterial({color:16777215,map:i,transparent:!0,side:THREE.DoubleSide,opacity:d}),f*g>1&&(i.wrapS=i.wrapT=THREE.RepeatWrapping,i.repeat.set(f,g))}var j=null;if(a.type.indexOf("Geometry")>-1?j=new THREE.Mesh(a,h):a instanceof THREE.Object3D&&(a.material=h,j=a),j&&a.physicsShape){var k=new CANNON.Body({mass:e,material:new CANNON.Material});k.addShape(a.physicsShape),k.linearDamping=k.angularDamping=.5,j.physics=k,k.graphics=j}return j}function brick(a){return textured(box(1,1,1),a)}function fill(a,b,c,d){void 0===c&&(c=1,void 0===d&&(d=1,void 0===b&&(b=1)));for(var e=hub(),f=0;d>f;++f)for(var g=0;c>g;++g)for(var h=0;b>h;++h)put(brick(a)).on(e).at(h,g,f);return e}function light(a,b,c,d){return new THREE.PointLight(a,b,c,d)}function v3(a,b,c){return new THREE.Vector3(a,b,c)}function quad(a,b){return void 0===b&&(b=a),new THREE.PlaneBufferGeometry(a,b)}function box(a,b,c){void 0===b&&(b=a,c=a);var d=new THREE.BoxGeometry(a,b,c);return d.physicsShape=new CANNON.Box(new CANNON.Vec3(a/2,b/2,c/2)),d}function hub(){return new THREE.Object3D}function sphere(a,b,c){var d=new THREE.SphereGeometry(a,b,c);return d.physicsShape=new CANNON.Sphere(a),d}function shell(a,b,c,d,e){void 0===d&&(d=.5*Math.PI),void 0===e&&(e=.5*Math.PI);var f=Math.PI+.5*d,g=.5*(Math.PI-e),h=new InsideSphereGeometry(a,b,c,f,d,g,e,!0);return h}var GRASS="/images/grass.png",ROCK="/images/rock.png",SAND="/images/sand.png",WATER="/images/water.png",DECK="/images/deck.png";