define(function(a){"use strict";function b(a,b,e){this.name=a,this.language=b,d.copyObject(this,{NORMAL:{65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"},SHIFT:{65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z"}}),d.copyObject(this,e);for(var f=0;9>=f;++f){var g=c["NUMPAD"+f];this.NORMAL[g]=f.toString()}}var c=a("./Keys"),d=a("./core");return b.DEAD=function(a){return function(b){b.setDeadKeyState("DEAD"+a)}},b}),define(function(a){"use strict";function b(a,b,c){this.i=a||0,this.x=b||0,this.y=c||0,this.moved=!0}function c(a,b){for(var c=a[b],d="",e=0;e<c.length;++e)d+=c[e].value;return d}var d=a("./core");return b.min=function(a,b){return a.i<=b.i?a:b},b.max=function(a,b){return a.i>b.i?a:b},b.prototype.toString=function(){return fmt("[i:$1 x:$2 y:$3]",this.i,this.x,this.y)},b.prototype.copy=function(a){this.i=a.i,this.x=a.x,this.y=a.y,this.moved=!1},b.prototype.fullhome=function(){this.i=0,this.x=0,this.y=0,this.moved=!0},b.prototype.fullend=function(a){this.i=0;for(var b=0,d=0;d<a.length;++d){var e=c(a,d);b=e.length,this.i+=b}this.y=a.length-1,this.x=b,this.moved=!0},b.prototype.skipleft=function(a){if(0===this.x)this.left(a);else{var b=this.x-1,e=c(a,this.y),f=d.reverse(e.substring(0,b)),g=f.match(/(\s|\W)+/),h=g?g.index+g[0].length+1:f.length;this.i-=h,this.x-=h}this.moved=!0},b.prototype.left=function(a){if(this.i>0){if(--this.i,--this.x,this.x<0){--this.y;var b=c(a,this.y);this.x=b.length}this.reverseFromNewline(a)&&++this.i}this.moved=!0},b.prototype.skipright=function(a){var b=c(a,this.y);if(this.x===b.length||"\n"===b[b.length-1])this.right(a);else{var d=this.x+1;b=b.substring(d);var e=b.match(/(\s|\W)+/),f=e?e.index+e[0].length+1:b.length-this.x;this.i+=f,this.x+=f,this.reverseFromNewline(a)}this.moved=!0},b.prototype.right=function(a){this.advanceN(a,1)},b.prototype.advanceN=function(a,b){if(this.y<a.length-1){var d=c(a,this.y);if(this.x<d.length){for(this.i+=b,this.x+=b;this.x>d.length;)this.x-=d.length,++this.y;this.x>0&&"\n"===d[this.x-1]&&(++this.y,this.x=0)}}this.moved=!0},b.prototype.home=function(){this.i-=this.x,this.x=0,this.moved=!0},b.prototype.end=function(a){var b=c(a,this.y),d=b.length-this.x;this.i+=d,this.x+=d,this.reverseFromNewline(a),this.moved=!0},b.prototype.up=function(a){if(this.y>0){--this.y;var b=c(a,this.y),d=Math.min(0,b.length-this.x);this.x+=d,this.i-=b.length-d,this.reverseFromNewline(a)}this.moved=!0},b.prototype.down=function(a){if(this.y<a.length-1){++this.y;var b=c(a,this.y),d=c(a,this.y-1),e=Math.min(0,b.length-this.x);this.x+=e,this.i+=d.length+e,this.reverseFromNewline(a)}this.moved=!0},b.prototype.incY=function(a,b){this.y=Math.max(0,Math.min(b.length-1,this.y+a));var d=c(b,this.y);this.x=Math.max(0,Math.min(d.length,this.x)),this.i=this.x;for(var e=0;e<this.y;++e)this.i+=c(b,e).length;this.reverseFromNewline(b),this.moved=!0},b.prototype.setXY=function(a,b,d){this.y=Math.max(0,Math.min(d.length-1,b));var e=c(d,this.y);this.x=Math.max(0,Math.min(e.length,a)),this.i=this.x;for(var f=0;f<this.y;++f)this.i+=c(d,f).length;this.reverseFromNewline(d),this.moved=!0},b.prototype.reverseFromNewline=function(a){var b=c(a,this.y);return this.x>0&&"\n"===b[this.x-1]?(--this.x,--this.i,!0):!1},b}),define(function(a){"use strict";function b(a,b){function e(a){for(var b=!1,c=0,d=0;d<a.length;++d){var e=a[d];e.line=c,"newlines"===e.type&&++c,b?("endBlockComments"===e.type&&(b=!1),"newlines"!==e.type&&(e.type="comments")):"startBlockComments"===e.type&&(b=!0,e.type="comments")}}this.name=a,this.grammar=b.map(function(a){return new c(a[0],a[1])}),this.tokenize=function(a){for(var b=[new d(a,"regular",0)],c=0;c<this.grammar.length;++c)for(var f=this.grammar[c],g=0;g<b.length;++g)f.carveOutMatchedToken(b,g);return e(b),b}}var c=a("./Rule"),d=a("./Token");return b}),define(function(){"use strict";var a={MODIFIER_KEYS:["CTRL","ALT","META","SHIFT"],SHIFT:16,CTRL:17,ALT:18,META_L:91,META_R:92,BACKSPACE:8,TAB:9,ENTER:13,SPACEBAR:32,DELETE:46,PAUSEBREAK:19,CAPSLOCK:20,NUMLOCK:144,SCROLLLOCK:145,INSERT:45,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40,SELECTKEY:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};for(var b in a){var c=a[b];a.hasOwnProperty(b)&&"number"==typeof c&&(a[c]=b)}return a}),define(function(){"use strict";function a(a,b,c,d,e){var f=b+"_"+c;a[f]=function(a,b){a["cursor"+d](b,a[e+"Cursor"])}}function b(b,c,d,e){a(b,c||"NORMAL",d,e,"front"),a(b,c+"SHIFT",d,e,"back")}function c(a,c,d,e,f,g,h,i,j,k){this.name=a,this[c+"_a"]=function(a,b){a.frontCursor.fullhome(b),a.backCursor.fullend(b),a.forceUpdate()},this[e]=function(a){a.redo(),a.scrollIntoView(a.frontCursor)},this[c+"_z"]=function(a){a.undo(),a.scrollIntoView(a.frontCursor)},this[c+"_DOWNARROW"]=function(a,b){a.scroll.y<b.length&&++a.scroll.y,a.forceUpdate()},this[c+"_UPARROW"]=function(a){a.scroll.y>0&&--a.scroll.y,a.forceUpdate()},b(this,"","LEFTARROW","Left"),b(this,"","RIGHTARROW","Right"),b(this,"","UPARROW","Up"),b(this,"","DOWNARROW","Down"),b(this,"","PAGEUP","PageUp"),b(this,"","PAGEDOWN","PageDown"),b(this,d,"LEFTARROW","SkipLeft"),b(this,d,"RIGHTARROW","SkipRight"),b(this,f,g,"Home"),b(this,f,h,"End"),b(this,i,j,"FullHome"),b(this,i,k,"FullEnd")}return c}),define(function(a){"use strict";function b(a,b){this.set(a||0,b||0)}var c=a("./core");return b.prototype.set=function(a,b){this.x=a,this.y=b},b.prototype.copy=function(a){a&&(this.x=a.x,this.y=a.y)},b.prototype.clone=function(){return new b(this.x,this.y)},b.prototype.toString=function(){return c.fmt("(x:$1, y:$2)",this.x,this.y)},b}),define(function(a){"use strict";function b(a,m){function n(){N=M.tokenize(G.getText()),G.drawText()}function o(){if(G.scroll.y<0)G.scroll.y=0;else for(;0<G.scroll.y&&G.scroll.y>O.length-ab.height;)--G.scroll.y}function p(){if(P){var a=kb.getCanvas().getBoundingClientRect();T.style.left=c.px(a.left),T.style.top=c.px(window.scrollY+a.top),T.style.width=0,T.style.height=0,lb.style.fontFamily=P.fontFamily;var b=kb.character.height/kb.getPixelRatio();lb.style.fontSize=c.px(.99*b),lb.style.lineHeight=c.px(b)}}function q(a,b,c){fb=!0,W.set(b,c),kb.pixel2cell(W,G.scroll,ab);var d=W.x-G.scroll.x,e=W.y-G.scroll.y,f=e>=ab.height,g=0>d,h=W.x>=ab.width;if(f||g||h){if(h&&!f){var i=O.length-ab.height;if(e>=0&&i>=0){var j=e*i/ab.height;G.scroll.y=Math.floor(j)}}else if(f&&!g){for(var k=0,l=0;l<O.length;++l){for(var m=O[l],n=0,o=0;o<m.length;++o)n+=m[o].value.length;k=Math.max(k,n)}var p=k-ab.width;if(d>=0&&p>=0){var q=d*p/ab.width;G.scroll.x=Math.floor(q)}}}else a.setXY(W.x,W.y,O),E(),G.backCursor.copy(a);X.copy(W)}function r(a,b){if(m.pointerEventSource){for(var c=0;c<l.length;++c){var d=l[c];d!==G&&d.blur()}G.focus();var e=m.pointerEventSource.getBoundingClientRect();G.startPointer(a-e.left,b-e.top)}}function s(a,b){if(m.pointerEventSource){var c=m.pointerEventSource.getBoundingClientRect();G.movePointer(a-c.left,b-c.top)}}function t(a){0===a.button&&(r(a.clientX,a.clientY),a.preventDefault())}function u(a){eb&&s(a.clientX,a.clientY)}function v(a){eb&&0===a.button&&G.endPointer()}function w(a){if(eb&&a.touches.length>0&&!db){var b=a.touches[0];r(b.clientX,b.clientY),S=b.identifier}}function x(a){for(var b=0;b<a.changedTouches.length&&db;++b){var c=a.changedTouches[b];if(c.identifier===S){s(c.clientX,c.clientY);break}}}function y(a){for(var b=0;b<a.changedTouches.length&&db;++b){var c=a.changedTouches[b];c.identifier===S&&G.endPointer()}}function z(a){if(a)for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];"function"!=typeof c&&(c=G.overwriteText.bind(G,c)),V[b]=c}}function A(){L&&I&&K&&(V={}),z(L),z(I),z(K)}function B(a){var b=a.toLowerCase();G["cursor"+a]=function(a,c){fb=!0,c[b](a),G.scrollIntoView(c)}}function C(){var a;gb?(a=Math.max(1,Math.ceil(Math.log(G.getLineCount())/Math.LN10)),bb.width=1):(a=0,bb.width=0),hb?ib?cb.set(kb.VSCROLL_WIDTH,0):cb.set(kb.VSCROLL_WIDTH,1):cb.set(0,0);var b=bb.width+a,d=0,e=Math.floor(G.getWidth()/kb.character.width)-b-cb.width,f=Math.floor(G.getHeight()/kb.character.height)-d-cb.height;ab.set(b,d,e,f);var g=kb.character.width/kb.getPixelRatio(),h=kb.character.height/kb.getPixelRatio();lb.style.left=c.px(ab.x*g),lb.style.top=c.px(ab.y*h),lb.style.width=c.px(ab.width*g),lb.style.height=c.px(ab.height*h),O=[[]];for(var i=0,j=N.slice(),k=0;k<j.length;++k){var l=j[k].clone(),m=ab.width-i,n=ib&&l.value.length>m,o="newlines"===l.type||n;n&&j.splice(k+1,0,l.splitAt(m)),O[O.length-1].push(l),i+=l.value.length,o&&(O.push([]),i=0)}return a}function D(a,b,c){var d=a-b,e=a-c+5,f=0;return(0>d||e>=0)&&(f=Math.abs(d)<Math.abs(e)?d:e),f}function E(){lb.selectionStart=Math.min(G.frontCursor.i,G.backCursor.i),lb.selectionEnd=Math.max(G.frontCursor.i,G.backCursor.i)}function F(a){a.returnValue=!1}var G=this;l.push(this),m=m||{},"string"==typeof m&&(m={file:m});var H,I,J,K,L,M,N,O,P,Q,R,S,T,U=m.renderer||b.Renderers.Canvas,V={},W=new d,X=new d,Y="",Z=[],$=[],_=-1,ab=new f,bb=new e,cb=new e,db=!1,eb=!1,fb=!1,gb=!0,hb=!0,ib=!1,jb=0,kb=new U(a,m),lb=c.cascadeElement("primrose-surrogate-textarea-"+kb.id,"textarea",window.HTMLTextAreaElement);this.frontCursor=new g,this.backCursor=new g,this.scroll=new d,["Left","Right","SkipLeft","SkipRight","Up","Down","Home","End","FullHome","FullEnd"].map(B.bind(this)),this.cursorPageUp=function(a,b){fb=!0,b.incY(-ab.height,a),this.scrollIntoView(b)},this.cursorPageDown=function(a,b){fb=!0,b.incY(ab.height,a),this.scrollIntoView(b)},this.focus=function(){eb=!0,this.forceUpdate()},this.blur=function(){eb=!1,this.forceUpdate()},this.isFocused=function(){return eb},this.getRenderer=function(){return kb},this.setWheelScrollSpeed=function(a){jb=a||25},this.getWheelScrollSpeed=function(){return jb},this.setWordWrap=function(a){ib=a||!1,this.forceUpdate()},this.getWordWrap=function(){return ib},this.setShowLineNumbers=function(a){gb=a,this.forceUpdate()},this.getShowLineNumbers=function(){return gb},this.setShowScrollBars=function(a){hb=a,this.forceUpdate()},this.getShowScrollBars=function(){return hb},this.setTheme=function(a){P=a||b.Themes.Default,kb.setTheme(P),kb.resize(),fb=!0,this.drawText()},this.getTheme=function(){return P},this.setDeadKeyState=function(a){fb=!0,Y=a||""},this.setOperatingSystem=function(a){fb=!0,I=a||(c.isOSX?b.OperatingSystems.OSX:b.OperatingSystems.Windows),A()},this.getOperatingSystem=function(){return I},this.setCommandSystem=function(a){fb=!0,K=a||b.Commands.TextEditor,A()},this.setSize=function(a,b){fb=kb.setSize(a,b)},this.getWidth=function(){return kb.getWidth()},this.getHeight=function(){return kb.getHeight()},this.forceUpdate=function(){fb=!0,this.drawText()},this.setCodePage=function(a){fb=!0;var c,d,e,f;if(H=a,!H){var g=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage||navigator.browserLanguage;g&&"en"!==g||(g="en-US");for(c in b.CodePages)if(a=b.CodePages[c],a.language===g){H=a;break}H||(H=b.CodePages.EN_US)}Z=[];for(c in h)d=h[c],isNaN(d)||(Z[d]=c);L={};for(var i in H){var j=H[i];if("object"==typeof j)for(d in j){if(d.indexOf("_")>-1){var k=d.split(" "),l=k[0];d=k[1],e=H.NORMAL[d],f=l+"_"+i+" "+e}else e=H.NORMAL[d],f=i+"_"+e;Z[d]=e,L[f]=j[d]}}A()},this.getCodePage=function(){return H},this.setTokenizer=function(a){fb=!0,M=a||b.Grammars.JavaScript,$&&$.length>0&&(n(),this.drawText&&this.drawText())},this.getTokenizer=function(){return M},this.getLines=function(){return $[_].slice()},this.getLineCount=function(){return $[_].length},this.getText=function(){return $[_].join("\n")},this.setText=function(a){a=a||"",a=a.replace(/\r\n/g,"\n");var b=a.split("\n");this.pushUndo(b),this.drawText(),lb.value=a,E()},Object.defineProperties(this,{value:{get:this.getText,set:this.setText}}),this.pushUndo=function(a){_<$.length-1&&$.splice(_+1),$.push(a),_=$.length-1,n(),this.forceUpdate()},this.redo=function(){fb=!0,_<$.length-1&&++_,n()},this.undo=function(){fb=!0,_>0&&--_,n()},this.setTabWidth=function(a){Q=a||4,R="";for(var b=0;Q>b;++b)R+=" "},this.getTabWidth=function(){return Q},this.getTabString=function(){return R},this.scrollIntoView=function(a){this.scroll.y+=D(a.y,this.scroll.y,this.scroll.y+ab.height),ib||(this.scroll.x+=D(a.x,this.scroll.x,this.scroll.x+ab.width)),o()},this.increaseFontSize=function(){++P.fontSize,fb=kb.resize()},this.decreaseFontSize=function(){P.fontSize>1&&(--P.fontSize,fb=kb.resize())},this.setFontSize=function(a){P.fontSize=a,fb=kb.resize()},this.getPixelRatio=function(){return window.devicePixelRatio||1},this.cell2i=function(a,b){for(var c=0,d=0;b>d;++d){for(var e=O[d],f=0;f<e.length;++f)c+=e[f].value.length;++c}return c+=a},this.i2cell=function(a){for(var b=0;b<O.length;++b){for(var c=O[b],d=0,e=0;e<c.length;++e)d+=c[e].value.length;if(d>=a)return{x:a,y:b};a-=d-1}},this.readWheel=function(a){this.scroll.y+=Math.floor(a.deltaY/jb),o(),a.preventDefault(),this.forceUpdate()},this.startPicking=function(a,b,c){var d=kb.getPixelIndex(a,b,c);this.startPointer(d.x,d.y)},this.movePicking=function(a,b,c){var d=kb.getPixelIndex(a,b,c);this.movePointer(d.x,d.y)},this.startPointer=function(a,b){q(this.frontCursor,a,b),db=!0,this.drawText()},this.movePointer=function(a,b){db&&(q(this.backCursor,a,b),this.drawText())},this.endPointer=function(){db=!1,lb.focus()},this.bindEvents=function(a,b,c,d){a&&(a.addEventListener("keydown",this.editText.bind(this)),lb.addEventListener("beforecopy",F),lb.addEventListener("beforecut",F),a.addEventListener("beforepaste",F)),b&&(b.addEventListener("wheel",this.readWheel.bind(this)),b.addEventListener("mousedown",t),b.addEventListener("mousemove",u),b.addEventListener("mouseup",v),b.addEventListener("touchstart",w),b.addEventListener("touchmove",x),b.addEventListener("touchend",y)),c&&c.addEventListener("wheel",this.readWheel.bind(this)),d&&(lb.addEventListener("copy",this.copySelectedText.bind(this)),lb.addEventListener("cut",this.cutSelectedText.bind(this)),a&&a.addEventListener("paste",this.readClipboard.bind(this)))},this.overwriteText=function(a){if(a=a||"",a=a.replace(/\r\n/g,"\n"),this.frontCursor.i!==this.backCursor.i||a.length>0){var b=g.min(this.frontCursor,this.backCursor),c=g.max(this.frontCursor,this.backCursor),d=this.getText(),e=d.substring(0,b.i),f=d.substring(c.i);this.setText(e+a+f),b.advanceN(O,a.length),this.scrollIntoView(c),o(),c.copy(b),this.forceDraw()}},this.pasteAtCursor=function(a){this.overwriteText(a),this.drawText()},this.copySelectedText=function(a){if(a.returnValue=!1,this.frontCursor.i!==this.backCursor.i){var b=g.min(this.frontCursor,this.backCursor),c=g.max(this.frontCursor,this.backCursor),d=this.getText(),e=d.substring(b.i,c.i),f=a.clipboardData||window.clipboardData;f.setData(window.clipboardData?"Text":"text/plain",e)}a.preventDefault()},this.cutSelectedText=function(a){this.copySelectedText(a),this.overwriteText(),this.drawText()},this.readClipboard=function(a){a.returnValue=!1;var b=a.clipboardData||window.clipboardData,c=b.getData(window.clipboardData?"Text":"text/plain");c&&this.pasteAtCursor(c)},this.editText=function(a){if(eb){a=a||event;var b=a.keyCode;if(b!==h.CTRL&&b!==h.ALT&&b!==h.META_L&&b!==h.META_R&&b!==h.SHIFT){var c=Y,d=Y;a.ctrlKey&&(d+="CTRL"),a.altKey&&(d+="ALT"),a.metaKey&&(d+="META"),a.shiftKey&&(d+="SHIFT"),d===Y&&(d+="NORMAL"),d+="_"+Z[b];var e=V[J+"_"+d]||V[d];e&&(this.frontCursor.moved=!1,this.backCursor.moved=!1,e(G,O),this.frontCursor.moved&&!this.backCursor.moved&&this.backCursor.copy(this.frontCursor),o(),a.preventDefault()),Y===c&&(Y="")}this.drawText()}},this.drawText=function(){kb.hasResized()&&(fb=kb.resize(),p()),fb&&P&&N&&this.forceDraw()},this.forceDraw=function(){var a=C();kb.render(O,this.frontCursor,this.backCursor,ab,this.scroll,eb,gb,hb,ib,a),E(),fb=!1},J=c.isChrome?"CHROMIUM":c.isFirefox?"FIREFOX":c.isIE?"IE":c.isOpera?"OPERA":c.isSafari?"SAFARI":"UNKNOWN",lb.style.position="absolute",T=c.makeHidingContainer("primrose-surrogate-textarea-container-"+kb.id,lb),document.body.insertBefore(T,document.body.children[0]),this.setWheelScrollSpeed(m.wheelScrollSpeed),this.setWordWrap(!m.disableWordWrap),this.setShowLineNumbers(!m.hideLineNumbers),this.setShowScrollBars(!m.hideScrollBars),this.setTabWidth(m.tabWidth),this.setTheme(m.theme),this.setFontSize(m.fontSize||14),this.setTokenizer(m.tokenizer),this.setCodePage(m.codePage),this.setOperatingSystem(m.os),this.setCommandSystem(m.commands),this.setText(m.file),(m.autoBindEvents||kb.autoBindEvents)&&(m.readOnly||void 0!==m.keyEventSource||(m.keyEventSource=window),void 0===m.pointerEventSource&&(m.pointerEventSource=kb.getCanvas()),void 0===m.wheelEventSource&&(m.wheelEventSource=kb.getCanvas())),this.bindEvents(m.keyEventSource,m.pointerEventSource,m.wheelEventSource,!m.disableClipboard),this.themeSelect=c.makeSelectorFromObj("primrose-theme-selector-"+kb.id,b.Themes,P.name,G,"setTheme","theme"),this.commandSystemSelect=c.makeSelectorFromObj("primrose-command-system-selector-"+kb.id,b.Commands,K.name,G,"setCommandSystem","command system"),this.tokenizerSelect=c.makeSelectorFromObj("primrose-tokenizer-selector-"+kb.id,b.Grammars,M.name,G,"setTokenizer","language syntax",k),this.keyboardSelect=c.makeSelectorFromObj("primrose-keyboard-selector-"+kb.id,b.CodePages,H.name,G,"setCodePage","localization",i),this.operatingSystemSelect=c.makeSelectorFromObj("primrose-operating-system-selector-"+kb.id,b.OperatingSystems,I.name,G,"setOperatingSystem","shortcut style",j),p()}var c=a("./core"),d=a("./Point"),e=a("./Size"),f=a("./Rectangle"),g=a("./Cursor"),h=a("./Keys"),i=a("./CodePage"),j=a("./OperatingSystem"),k=a("./Grammar"),l=[];return b.Themes={Default:a("./themes/Default"),Dark:a("./themes/Dark")},b.Renderers={Canvas:a("./renderers/Canvas")},b.OperatingSystems={Windows:a("./operating_systems/Windows"),OSX:a("./operating_systems/OSX")},b.CodePages={EN_US:a("./code_pages/EN_US"),EN_UKX:a("./code_pages/EN_UKX"),FR_AZERTY:a("./code_pages/FR_AZERTY"),DE_QWERTZ:a("./code_pages/DE_QWERTZ")},b.Commands={TextEditor:a("./command_packs/TextEditor")},b.Grammars={JavaScript:a("./grammars/JavaScript"),PlainText:a("./grammars/PlainText"),TestResults:a("./grammars/TestResults")},b.Keys=h,b}),define(function(a){"use strict";function b(a,b,e,f){this.point=new c(a,b),this.size=new d(e,f),Object.defineProperties(this,{x:{get:function(){return this.point.x},set:function(a){this.point.x=a}},left:{get:function(){return this.point.x},set:function(a){this.point.x=a}},width:{get:function(){return this.size.width},set:function(a){this.size.width=a}},right:{get:function(){return this.point.x+this.size.width},set:function(a){this.point.x=a-this.size.width}},y:{get:function(){return this.point.y},set:function(a){this.point.y=a}},top:{get:function(){return this.point.y},set:function(a){this.point.y=a}},height:{get:function(){return this.size.height},set:function(a){this.size.height=a}},bottom:{get:function(){return this.point.y+this.size.height},set:function(a){this.point.y=a-this.size.height}}})}var c=a("./Point"),d=a("./Size"),e=a("./core");return b.prototype.set=function(a,b,c,d){this.point.set(a,b),this.size.set(c,d)},b.prototype.copy=function(a){a&&(this.point.copy(a.point),this.size.copy(a.size))},b.prototype.clone=function(){return new b(this.point.x,this.point.y,this.size.width,this.size.height)},b.prototype.toString=function(){return e.fmt("[$1 x $2]",this.point.toString(),this.size.toString())},b}),define(function(){"use strict";function a(a,b){this.name=a,this.test=b}return a.prototype.carveOutMatchedToken=function(a,b){var c=a[b];if("regular"===c.type){var d=this.test.exec(c.value);if(d){for(var e=d[d.length-1],f=d.index,g=1;g<d.length-1;++g)f+=d[g].length;var h=f+e.length;if(0===f){if(c.type=this.name,h<c.value.length){var i=c.splitAt(h);i.type="regular",a.splice(b+1,0,i)}}else{var j=c.splitAt(f);if(e.length<j.value.length){var k=j.splitAt(e.length);a.splice(b+1,0,k)}j.type=this.name,a.splice(b+1,0,j)}}}},a}),define(function(a){"use strict";function b(a,b){this.set(a||0,b||0)}var c=a("./core");return b.prototype.set=function(a,b){this.width=a,this.height=b},b.prototype.copy=function(a){a&&(this.width=a.width,this.height=a.height)},b.prototype.clone=function(){return new b(this.width,this.height)},b.prototype.toString=function(){return c.fmt("<w:$1, h:$2>",this.width,this.height)},b}),define(function(){"use strict";function a(a,b,c,d){this.value=a,this.type=b,this.index=c,this.line=d}return a.prototype.clone=function(){return new a(this.value,this.type,this.index,this.line)},a.prototype.splitAt=function(b){var c=this.value.substring(b);return this.value=this.value.substring(0,b),new a(c,this.type,this.index+b,this.line)},a}),define(function(a){"use strict";var b=a("../CodePage");return new b("Deutsch: QWERTZ","de",{deadKeys:[220,221,160,192],NORMAL:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",60:"<",63:"ß",160:b.DEAD(3),163:"#",171:"+",173:"-",186:"ü",187:"+",188:",",189:"-",190:".",191:"#",192:b.DEAD(4),219:"ß",220:b.DEAD(1),221:b.DEAD(2),222:"ä",226:"<"},DEAD1NORMAL:{65:"â",69:"ê",73:"î",79:"ô",85:"û",190:"."},DEAD2NORMAL:{65:"á",69:"é",73:"í",79:"ó",83:"s",85:"ú",89:"ý"},SHIFT:{48:"=",49:"!",50:'"',51:"§",52:"$",53:"%",54:"&",55:"/",56:"(",57:")",60:">",63:"?",163:"'",171:"*",173:"_",186:"Ü",187:"*",188:";",189:"_",190:":",191:"'",192:"Ö",219:"?",222:"Ä",226:">"},CTRLALT:{48:"}",50:"²",51:"³",55:"{",56:"[",57:"]",60:"|",63:"\\",69:"€",77:"µ",81:"@",171:"~",187:"~",219:"\\",226:"|"},CTRLALTSHIFT:{63:"ẞ",219:"ẞ"},DEAD3NORMAL:{65:"a",69:"e",73:"i",79:"o",85:"u",190:"."},DEAD4NORMAL:{65:"a",69:"e",73:"i",79:"o",83:"s",85:"u",89:"y"}})}),define(function(a){"use strict";var b=a("../CodePage");return new b("English: UK Extended","en-GB",{CTRLALT:{52:"€",65:"á",69:"é",73:"í",79:"ó",85:"ú",163:"\\",192:"¦",222:"\\",223:"¦"},CTRLALTSHIFT:{65:"Á",69:"É",73:"Í",79:"Ó",85:"Ú",222:"|"},NORMAL:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",163:"#",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"'",219:"[",220:"\\",221:"]",222:"#",223:"`"},SHIFT:{48:")",49:"!",50:'"',51:"£",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",163:"~",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"@",219:"{",220:"|",221:"}",222:"~",223:"¬"}})}),define(function(a){"use strict";var b=a("../CodePage");return new b("English: USA","en-US",{NORMAL:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'"},SHIFT:{48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",219:"{",220:"|",221:"}",222:'"'}})}),define(function(a){"use strict";var b=a("../CodePage");return new b("Français: AZERTY","fr",{deadKeys:[221,50,55],NORMAL:{48:"à",49:"&",50:"é",51:'"',52:"'",53:"(",54:"-",55:"è",56:"_",57:"ç",186:"$",187:"=",188:",",190:";",191:":",192:"ù",219:")",220:"*",221:b.DEAD(1),222:"²",223:"!",226:"<"},SHIFT:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",186:"£",187:"+",188:"?",190:".",191:"/",192:"%",219:"°",220:"µ",223:"§",226:">"},CTRLALT:{48:"@",50:b.DEAD(2),51:"#",52:"{",53:"[",54:"|",55:b.DEAD(3),56:"\\",57:"^",69:"€",186:"¤",187:"}",219:"]"},DEAD1NORMAL:{65:"â",69:"ê",73:"î",79:"ô",85:"û"},DEAD2NORMAL:{65:"ã",78:"ñ",79:"õ"},DEAD3NORMAL:{48:"à",50:"é",55:"è",65:"à",69:"è",73:"ì",79:"ò",85:"ù"}})}),define(function(){"use strict";return{name:"Basic commands",NORMAL_SPACEBAR:" ",SHIFT_SPACEBAR:" ",NORMAL_BACKSPACE:function(a,b){a.frontCursor.i===a.backCursor.i&&a.frontCursor.left(b),a.overwriteText(),a.scrollIntoView(a.frontCursor)},NORMAL_ENTER:function(a,b){var c="",d=b[a.frontCursor.y];d.length>0&&"whitespace"===d[0].type&&(c=d[0].value),a.overwriteText("\n"+c),a.scrollIntoView(a.frontCursor)},NORMAL_DELETE:function(a,b){a.frontCursor.i===a.backCursor.i&&a.backCursor.right(b),a.overwriteText(),a.scrollIntoView(a.frontCursor)},SHIFT_DELETE:function(a,b){a.frontCursor.i===a.backCursor.i&&(a.frontCursor.home(b),a.backCursor.end(b)),a.overwriteText(),a.scrollIntoView(a.frontCursor)},NORMAL_TAB:function(a){var b=a.getTabString();a.overwriteText(b)}}}),define(function(){"use strict";function a(a,b){return b.replace(/( AM| PM|$)/,function(b,c){return(a.getMilliseconds()/1e3).toString().substring(1)+c})}function b(a,b){var c=Math.pow(10,b),d=(Math.round(a*c)/c).toString();if(b>0){var e=d.indexOf(".");for(-1===e&&(d+=".",e=d.length-1);d.length-e-1<b;)d+="0"}return d}function c(c){var d=/\$(0*)(\d+)(?:\.(0+))?/g,e=arguments;return"string"!=typeof c&&(c=c.toString()),c.replace(d,function(c,d,f,g){if(f=parseInt(f,10),f>=0&&f<e.length){var h=e[f];if(null!==h&&void 0!==h){if(h instanceof Date&&g){switch(g.length){case 1:h=h.getYear();break;case 2:h=h.getMonth()+1+"/"+h.getYear();break;case 3:h=h.toLocaleDateString();break;case 4:h=a(h,h.toLocaleTimeString());break;case 5:case 6:h=h.toLocaleString();break;default:h=a(h,h.toLocaleString())}return h}if(h=g&&g.length>0?b(h,g.length):h.toString(),d&&d.length>0)for(var i=new RegExp("^\\d{"+(d.length+1)+"}(\\.\\d+)?");!i.test(h);)h="0"+h;return h}}return void 0})}function d(a,b,c){var d=null;if(null===a?(d=document.createElement(b),d.id=a="auto_"+b+Date.now()):void 0===c||a instanceof c?d=a:"string"==typeof a&&(d=document.getElementById(a),null===d?(d=document.createElement(b),d.id=a):d.tagName!==b.toUpperCase()&&(d=null)),null===d)throw new Error(a+" does not refer to a valid "+b+" element.");return d.innerHTML="",d}function e(a,b,c){c=0|c;for(var d in b)b.hasOwnProperty(d)&&("object"!=typeof b[d]?a[d]=b[d]:3>c&&(a[d]||(a[d]={}),e(a[d],b[d],c+1)))}function f(a){var b={},c={},d=[];if(a){for(var e in a)0!==e.indexOf("on")||a===navigator&&"onLine"===e?"function"==typeof a[e]?b[e]=a[e]:c[e]=a[e]:d.push(e.substring(2));var f=typeof a;if("function"===f)f=a.toString().match(/(function [^(]*)/)[1];else if("object"===f)if(f=null,a.constructor&&a.constructor.name)f=a.constructor.name;else{for(var g=[{prefix:"",obj:window}],h=[];g.length>0&&null===f;){var i=g.shift();i.___traversed___=!0,h.push(i);for(e in i.obj){var j=i.obj[e];if(j)if("function"==typeof j){if(j.prototype&&a instanceof j){f=i.prefix+e;break}}else j.___tried___||g.push({prefix:i.prefix+e+".",obj:j})}}h.forEach(function(a){delete a.___traversed___})}return a={type:f,events:d,functions:b,properties:c},console.debug(a),a}console.warn("Object was falsey.")}navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate||window.RTCIceCandidate,window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription||window.RTCSessionDescription,screen.lockOrientation=screen.lockOrientation||screen.mozLockOrientation||screen.msLockOrientation||function(){},document.documentElement.requestFullscreen||(document.documentElement.msRequestFullscreen?(document.documentElement.requestFullscreen=document.documentElement.msRequestFullscreen,document.exitFullscreen=document.msExitFullscreen):document.documentElement.mozRequestFullScreen?(document.documentElement.requestFullscreen=document.documentElement.mozRequestFullScreen,document.exitFullscreen=document.mozCancelFullScreen):document.documentElement.webkitRequestFullscreen&&(document.documentElement.requestFullscreen=document.documentElement.webkitRequestFullscreen,document.exitFullscreen=document.webkitExitFullscreen));var g=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;return{copyObject:e,makeURL:function(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&"function"!=typeof b[d]&&c.push(encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return a+"?"+c.join("&")},XHR:function(a,b,c,d,e,f,g){var h=new XMLHttpRequest;h.onerror=e,h.onabort=e,h.onprogress=d,h.onload=function(){h.status<400?f&&f(h.response):e&&e()},h.open(b,a),c&&(h.responseType=c),g?(h.setRequestHeader("Content-Type","application/json;charset=UTF-8"),h.send(JSON.stringify(g))):h.send()},GET:function(a,b,c,d,e){b=b||"text",XHR(a,"GET",b,c,d,e)},POST:function(a,b,c,d,e,f){XHR(a,"POST",c,d,e,f,b)},getObject:function(a,b,c,d){var e=d&&c&&b,f=d&&c||c&&b,g=d||c||b;GET(a,"json",e,f,g)},sendObject:function(a,b,c,d,e){POST(a,b,"json",e&&d&&c,e&&d||d&&c,e||d||c)},arr:function(a,b,c){return Array.prototype.slice.call(a,b,c)},map:function(a,b){return Array.prototype.map.call(a,b)},reduce:function(a,b,c){return Array.prototype.reduce.call(a,b,c)},filter:function(a,b){return Array.prototype.filter.call(a,b)},ofType:function(a,b){return"function"==typeof b?filter(a,function(a){return a instanceof b}):filter(a,function(a){return typeof a===b})},agg:function(a,b,c){return"function"!=typeof b&&(b=function(a,b){return b[a]}.bind(window,b)),a.map(b).reduce(c)},add:function(a,b){return a+b},sum:function(a,b){return agg(a,b,add)},group:function(a,b,c){var d=[],e=a.slice();e.sort(function(a,c){var d=b?b(a):a,e=b?b(c):c;return e>d?-1:d>e?1:0});for(var f=0;f<e.length;++f){var g=e[f],h=b?b(g):g,i=c?c(g):g;(0===d.length||d[d.length-1].key!==h)&&d.push({key:h,values:[]}),d[d.length-1].values.push(i)}return d},reverse:function(){function a(d){d=d.replace(b,function(b,c,d){return a(d)+c}).replace(c,"$2$1");for(var e="",f=d.length-1;f>=0;--f)e+=d[f];return e}var b=/(<%= allExceptCombiningMarks %>)(<%= combiningMarks %>+)/g,c=/(<%= highSurrogates %>)(<%= lowSurrogates %>)/g;return a}(),help:f,cascadeElement:d,fmt:c,log:function(){console.log(c.apply(window,arguments))},err:function(){console.error(c.apply(window,arguments))},px:c.bind(this,"$1px"),pct:c.bind(this,"$1%"),ems:c.bind(this,"$1em"),findEverything:function(a,b){a=a||document,b=b||{};for(var c=a.querySelectorAll("*"),d=0;d<c.length;++d){var e=c[d];e.id&&e.id.length>0&&(b[e.id]=e,e.parentElement&&(e.parentElement[e.id]=e))}return b},inherit:function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a},getSetting:function(a,b){if(window.localStorage){var c=window.localStorage.getItem(a);if(c)try{return JSON.parse(c)}catch(d){console.error("getSetting",a,c,typeof c,d)}}return b},setSetting:function(a,b){if(window.localStorage&&b)try{window.localStorage.setItem(a,JSON.stringify(b))}catch(c){console.error("setSetting",a,b,typeof b,c)}},deleteSetting:function(a){window.localStorage&&window.localStorage.removeItem(a)},readForm:function(a){var b={};if(a)for(var c in a){var d=a[c];"INPUT"!==d.tagName&&"SELECT"!==d.tagName||d.dataset&&d.dataset.skipcache||("text"===d.type||"password"===d.type||"SELECT"===d.tagName?b[c]=d.value:("checkbox"===d.type||"radio"===d.type)&&(b[c]=d.checked))}return b},writeForm:function(a,b){if(b)for(var c in a){var d=a[c];null===b[c]||void 0===b[c]||"INPUT"!==d.tagName&&"SELECT"!==d.tagName||d.dataset&&d.dataset.skipcache||("text"===d.type||"password"===d.type||"SELECT"===d.tagName?d.value=b[c]:("checkbox"===d.type||"radio"===d.type)&&(d.checked=b[c]))}},reloadPage:function(){document.location=document.location.href},makeSelectorFromObj:function(a,b,c,e,f,g,h){var i=d(a,"select",window.HTMLSelectElement),j=[];for(var k in b)if(b.hasOwnProperty(k)){var l=b[k];if(!h||l instanceof h){l=l.name||k;var m=document.createElement("option");m.innerHTML=l,j.push(b[k]),l===c&&(m.selected="selected"),i.appendChild(m)}}"function"==typeof e[f]?i.addEventListener("change",function(){e[f](j[i.selectedIndex])}):i.addEventListener("change",function(){e[f]=j[i.selectedIndex]
});var n=d("container -"+a,"div",window.HTMLDivElement),o=d("label-"+a,"span",window.HTMLSpanElement);return o.innerHTML=g+": ",o["for"]=i,i.title=g,i.alt=g,n.appendChild(o),n.appendChild(i),n},makeHidingContainer:function(a,b){var c=d(a,"div",window.HTMLDivElement);return c.style.position="absolute",c.style.left=0,c.style.top=0,c.style.width=0,c.style.height=0,c.style.overflow="hidden",c.appendChild(b),c},isMobile:function(a){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substring(0,4))}(navigator.userAgent||navigator.vendor||window.opera),isiOS:/Apple-iP(hone|od|ad)/.test(navigator.userAgent||""),isOSX:/Macintosh/.test(navigator.userAgent||""),isWindows:/Windows/.test(navigator.userAgent||""),isOpera:g,isFirefox:"undefined"!=typeof window.InstallTrigger,isSafari:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome:!!window.chrome&&!g,isIE:!1||!!document.documentMode,isFullScreenMode:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},requestFullScreen:function(a,b){if(b||(b=a,a=null),isFullScreenMode())b&&b();else{document.documentElement.requestFullscreen(a?{vrDisplay:a}:window.Element.ALLOW_KEYBOARD_INPUT);var c=setInterval(function(){isFullScreenMode()&&(clearInterval(c),screen.lockOrientation("landscape-primary"),b&&b())},1e3)}},exitFullScreen:function(){isFullScreenMode()&&document.exitFullscreen()},toggleFullScreen:function(){document.documentElement.requestFullscreen&&(isFullScreenMode()?exitFullScreen():requestFullScreen())},addFullScreenShim:function(){function a(){c.forEach(function(a){a.events.forEach(function(c){a.elem.removeEventListener(c,b)})})}function b(){requestFullScreen(a)}var c=arr(arguments);c=c.map(function(a){return{elem:a,events:f(a).events}}),c.forEach(function(a){a.events.forEach(function(c){c.indexOf("fullscreenerror")<0&&a.elem.addEventListener(c,b,!1)})})},exitPointerLock:(document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock||function(){}).bind(document),isPointerLocked:function(){return!!(document.pointerLockElement||document.webkitPointerLockElement||document.mozPointerLockElement)},requestPointerLock:(document.documentElement.requestPointerLock||document.documentElement.webkitRequestPointerLock||document.documentElement.mozRequestPointerLock||function(){}).bind(document.documentElement)}}),define(function(a){"use strict";var b=a("../Grammar");return new b("JavaScript",[["newlines",/(?:\r\n|\r|\n)/],["comments",/\/\/.*$/],["startBlockComments",/\/\*/],["endBlockComments",/\*\//],["strings",/"(?:\\"|[^"])*"/],["strings",/'(?:\\'|[^'])*'/],["strings",/\/(?:\\\/|[^/])*\/\w*/],["numbers",/-?(?:(?:\b\d*)?\.)?\b\d+\b/],["keywords",/\b(?:break|case|catch|const|continue|debugger|default|delete|do|else|export|finally|for|function|if|import|in|instanceof|let|new|return|super|switch|this|throw|try|typeof|var|void|while|with)\b/],["functions",/(\w+)(?:\s*\()/],["members",/(?:(?:\w+\.)+)(\w+)/]])}),define(function(a){"use strict";var b=a("../Grammar");return new b("PlainText",[["newlines",/(?:\r\n|\r|\n)/]])}),define(function(a){"use strict";var b=a("../Grammar");return new b("TestResults",[["newlines",/(?:\r\n|\r|\n)/],["numbers",/(\[)(o+)/],["numbers",/(\d+ succeeded), 0 failed/],["numbers",/^    Successes:/],["functions",/(x+)\]/],["functions",/[1-9]\d* failed/],["functions",/^    Failures:/],["comments",/(\d+ms:)(.*)/],["keywords",/(Test results for )(\w+):/],["strings",/        \w+/]])}),define(function(a){"use strict";var b=a("../OperatingSystem");return new b("OS X","META","ALT","METASHIFT_z","META","LEFTARROW","RIGHTARROW","META","UPARROW","DOWNARROW")}),define(function(a){"use strict";var b=a("../OperatingSystem");return new b("Windows","CTRL","CTRL","CTRL_y","","HOME","END","CTRL","HOME","END")}),define(function(a){"use strict";var b=a("../core"),c=a("../Size"),d=a("../Cursor"),e=a("../themes/Default");return function(a,f){function g(a,b,c,d,e,f){a.fillStyle=b,a.fillRect(c*k.character.width,d*k.character.height,e*k.character.width+1,f*k.character.height+1)}function h(a,b,c,f,h,i){var j=d.min(b,c),m=d.max(b,c),n=new d,o=new d,p=t.regular.backColor?"fillRect":"clearRect";t.regular.backColor&&(r.fillStyle=t.regular.backColor),r[p](0,0,l.width,l.height),r.save(),r.translate((f.x-h.x)*k.character.width,-h.y*k.character.height),i&&g(r,t.regular.currentRowBackColor||e.regular.currentRowBackColor,0,j.y+.2,f.width,m.y-j.y+1);for(var q=0;q<a.length;++q){for(var s=a[q],u=0;u<s.length;++u){var v=s[u];if(o.x+=v.value.length,o.i+=v.value.length,h.y<=q&&q<h.y+f.height&&h.x<=o.x&&n.x<h.x+f.width){var w=j.i<=o.i&&n.i<m.i;if(w){var x=d.max(j,n),y=d.min(m,o),z=y.i-x.i;g(r,t.regular.selectedBackColor||e.regular.selectedBackColor,x.x,x.y+.2,z,1)}}n.copy(o)}n.x=0,++n.y,o.copy(n)}i&&(r.beginPath(),r.strokeStyle=t.cursorColor||"black",r.moveTo(j.x*k.character.width,j.y*k.character.height),r.lineTo(j.x*k.character.width,(j.y+1.25)*k.character.height),r.moveTo(m.x*k.character.width+1,m.y*k.character.height),r.lineTo(m.x*k.character.width+1,(m.y+1.25)*k.character.height),r.stroke()),r.restore()}function i(a,b,c){var e=new d,f=new d,g=0;q.clearRect(0,0,l.width,l.height),q.save(),q.translate((b.x-c.x)*k.character.width,-c.y*k.character.height);for(var h=0;h<a.length;++h){for(var i=a[h],j=0;j<i.length;++j){var m=i[j];if(f.x+=m.value.length,f.i+=m.value.length,c.y<=h&&h<c.y+b.height&&c.x<=f.x&&e.x<c.x+b.width){var n=t[m.type]||{},o=(n.fontWeight||t.regular.fontWeight||"")+" "+(n.fontStyle||t.regular.fontStyle||"")+" "+k.character.height+"px "+t.fontFamily;q.font=o.trim(),q.fillStyle=n.foreColor||t.regular.foreColor,q.fillText(m.value,e.x*k.character.width,(h+1)*k.character.height)}e.copy(f)}g=Math.max(g,f.x),e.x=0,++e.y,f.copy(e)}return q.restore(),g}function j(a,b,c,d,f,h,i,j){if(s.clearRect(0,0,l.width,l.height),s.save(),s.translate(0,-c.y*k.character.height),d)for(var m=c.y,n=-1;m<c.y+b.height&&m<a.length;++m){for(var o=a[m],p=o.length>0?o[0].line:n+1,q=p.toString();q.length<i;)q=" "+q;g(s,t.regular.selectedBackColor||e.regular.selectedBackColor,0,m+.2,b.x,1),s.font="bold "+k.character.height+"px "+t.fontFamily,p>n&&(s.fillStyle=t.regular.foreColor,s.fillText(q,0,(m+1)*k.character.height)),n=p}if(s.restore(),f){var r=b.width*k.character.width,u=b.height*k.character.height,v=c.x*r/j+b.x*k.character.width,w=c.y*u/a.length+b.y*k.character.height;if(s.fillStyle=t.regular.selectedBackColor||e.regular.selectedBackColor,!h&&j>b.width){var x=r*(b.width/j);s.fillRect(v,(b.height+.25)*k.character.height,Math.max(k.character.width,x),k.character.height)}if(a.length>b.height){var y=u*(b.height/a.length);s.fillRect(l.width-k.VSCROLL_WIDTH*k.character.width,w,k.VSCROLL_WIDTH*k.character.width,Math.max(k.character.height,y))}}}var k=this,l=b.cascadeElement(a,"canvas",window.HTMLCanvasElement),m=b.cascadeElement(l.id+"-back","canvas",window.HTMLCanvasElement),n=b.cascadeElement(l.id+"-front","canvas",window.HTMLCanvasElement),o=b.cascadeElement(l.id+"-trim","canvas",window.HTMLCanvasElement),p=l.getContext("2d"),q=n.getContext("2d"),r=m.getContext("2d"),s=o.getContext("2d"),t=null,u=null,v=null,w=null;this.VSCROLL_WIDTH=2,this.character=new c,this.id=l.id,this.autoBindEvents=!0,this.setTheme=function(a){t=a},this.pixel2cell=function(a,b,c){var d=this.getPixelRatio();a.set(Math.round(a.x*d/this.character.width)+b.x-c.x,Math.floor(a.y*d/this.character.height-.25)+b.y)},this.hasResized=function(){var a=this.getPixelRatio(),b=l.width,c=l.height,d=l.clientWidth*a,e=l.clientHeight*a;return b!==d||c!==e},this.resize=function(){var a=!1;if(t){var b=this.getPixelRatio(),c=this.character.width,d=this.character.height,e=l.width,f=l.height,g=l.clientWidth*b,h=l.clientHeight*b,i=p.font;this.character.height=t.fontSize*b,p.font=this.character.height+"px "+t.fontFamily,this.character.width=p.measureText("MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM").width/100,a=c!==this.character.width||d!==this.character.height||i!==p.font,g>0&&h>0&&(m.width=n.width=o.width=l.width=g,m.height=n.height=o.height=l.height=h,a=a||e!==g||f!==g)}return a},this.setSize=function(a,b){return l.style.width=a+"px",l.style.height=b+"px",this.resize()},this.getWidth=function(){return l.width},this.getHeight=function(){return l.height},this.render=function(a,b,c,d,e,f,g,k,q,r){var s=0;h(a,b,c,d,e,f),s=i(a,d,e),j(a,d,e,g,k,q,r,s),p.clearRect(0,0,l.width,l.height),p.drawImage(m,0,0),p.drawImage(n,0,0),p.drawImage(o,0,0),u&&(u.needsUpdate=!0)},this.getCanvas=function(){return l},this.getTexture=function(a){return"undefined"==typeof window.THREE||u||(u=new THREE.Texture(l),u.anisotropy=a||8,u.needsUpdate=!0),u},this.getPickingTexture=function(){if(!v){var a=document.createElement("canvas"),b=this.getWidth(),c=this.getHeight();a.width=b,a.height=c;for(var d=a.getContext("2d"),e=d.createImageData(b,c),f=0,g=0,h=b*c;h>f;++f,g+=4)e.data[g]=(16711680&f)>>16,e.data[g+1]=(65280&f)>>8,e.data[g+2]=(255&f)>>0,e.data[g+3]=255;d.putImageData(e,0,0),v=new THREE.Texture(a,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestMipMapNearestFilter,THREE.RGBAFormat,THREE.UnsignedByteType,0),v.needsUpdate=!0}return v},this.getPixelRatio=function(){return window.devicePixelRatio||1},this.getPixelIndex=function(a,b,c){w||(w=new Uint8Array(4)),a.readPixels(b,c,1,1,a.RGBA,a.UNSIGNED_BYTE,w);var d=w[0]<<16|w[1]<<8|w[2]<<0;return{x:d%l.width,y:d/l.width}},a instanceof window.HTMLCanvasElement||!f.width||!f.height||(l.style.position="absolute",l.style.width=f.width,l.style.height=f.height),l.parentElement||(this.autoBindEvents=!1,document.body.appendChild(b.makeHidingContainer("primrose-container-"+l.id,l)))}}),define(function(){"use strict";return{name:"Dark",fontFamily:"monospace",cursorColor:"white",fontSize:14,regular:{backColor:"black",foreColor:"#c0c0c0",currentRowBackColor:"#202020",selectedBackColor:"#404040"},strings:{foreColor:"#aa9900",fontStyle:"italic"},numbers:{foreColor:"green"},comments:{foreColor:"yellow",fontStyle:"italic"},keywords:{foreColor:"cyan"},functions:{foreColor:"brown",fontWeight:"bold"},members:{foreColor:"green"},error:{foreColor:"red",fontStyle:"underline italic"}}}),define(function(){"use strict";return{name:"Light",fontFamily:"monospace",cursorColor:"black",fontSize:14,regular:{backColor:"white",foreColor:"black",currentRowBackColor:"#f0f0f0",selectedBackColor:"#c0c0c0"},strings:{foreColor:"#aa9900",fontStyle:"italic"},numbers:{foreColor:"green"},comments:{foreColor:"grey",fontStyle:"italic"},keywords:{foreColor:"blue"},functions:{foreColor:"brown",fontWeight:"bold"},members:{foreColor:"green"},error:{foreColor:"red",fontStyle:"underline italic"}}}),Primrose.VERSION="v0.9.0.0";