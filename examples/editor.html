<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
        <title>Primrose: Canvas-based text editor</title>
        <script type="text/javascript" src="rosetta_24_game.js"></script>
        <script type="text/javascript" src="../src/core.js"></script>
        <script type="text/javascript" src="../src/Cursor.js"></script>
        <script type="text/javascript" src="../src/Dimensions.js"></script>
        <script type="text/javascript" src="../src/Grammar.js"></script>
        <script type="text/javascript" src="../src/Keys.js"></script>
        <script type="text/javascript" src="../src/Primrose.js"></script>
        <script type="text/javascript" src="../src/code_pages/DE_QWERTZ.js"></script>
        <script type="text/javascript" src="../src/code_pages/EN_UKX.js"></script>
        <script type="text/javascript" src="../src/code_pages/EN_US.js"></script>
        <script type="text/javascript" src="../src/code_pages/FR_AZERTY.js"></script>
        <script type="text/javascript" src="../src/command_packs/Default.js"></script>
        <script type="text/javascript" src="../src/grammars/JavaScript.js"></script>
        <script type="text/javascript" src="../src/grammars/PlainText.js"></script>
        <script type="text/javascript" src="../src/grammars/TestResults.js"></script>
        <script type="text/javascript" src="../src/operating_systems/OSX.js"></script>
        <script type="text/javascript" src="../src/operating_systems/Windows.js"></script>
        <script type="text/javascript" src="../src/renderers/Canvas.js"></script>
        <script type="text/javascript" src="../src/themes/Dark.js"></script>
        <script type="text/javascript" src="../src/themes/Default.js"></script>
        <script type="text/javascript" src="../test/testing.js"></script>
        <script type="text/javascript" src="../test/Point.js"></script>
        <script type="text/javascript" src="../test/Size.js"></script>
        <script type="text/javascript" src="../test/Rectangle.js"></script>
        <script type="text/javascript" src="../test/Grammar.js"></script>
        <style type="text/css">
            html, body{
                position:absolute;
                height:100%;
                width:100%;
                padding:0;
                margin:0;
            }
            #controls > div{
                display: inline-block;
                padding-right: 0.5em;
            }
        </style>
    </head>
    <body>
        <div style="position:absolute;height:100%;width:100%">
            <div id="controls" style="position:absolute;height:7em;width:100%">
                <div><input type="checkbox" id="toggleWordWrap"><label for="toggleWordWrap">Word wrap</label></div>
                <div><input type="checkbox" id="toggleLineNumbers"><label for="toggleLineNumbers">Line numbers</label></div>
                <div><input type="checkbox" id="toggleScrollBars"><label for="toggleScrollBars">Scroll bars</label></div>
            </div>
            <div style="position:absolute;top:2em;bottom:0;width:100%;">
                <canvas id="output" style="position:absolute;height:100%;width:50%;cursor:text"></canvas>
                <canvas id="testResultsView" style="position:absolute;left:50%;height:100%;width:50%;"></canvas>
            </div>
        </div>

        <script type="text/javascript">
            var prim, ctrls, testResults;

            function onToggle(e, f) {
                e.addEventListener("change", function () {
                    prim["set" + f](e.checked);
                });
                e.checked = prim["get" + f]();
            }

            window.addEventListener("load", function () {
                ctrls = findEverything();

                with (ctrls) {
                    prim = new Primrose(output, Renderers.Canvas, {
                        file: rosetta_24_game.toString(),
                        keyEventSource: window,
                        pointerEventSource: output,
                        wheelEventSource: output
                    });

                    var results = [
                        Point, 
                        Size, 
                        Rectangle, 
                        Grammar
                    ].map(stringTest).join("===---===---===---===---===---===\n");
                    testResults = new Primrose(testResultsView, Renderers.Canvas, {
                        file: results,
                        wheelEventSource: testResultsView,
                        tokenizer: Grammar.TestResults,
                        theme: Themes.Dark
                    });

                    prim.placeSurrogateUnder(prim.getRenderer().getCanvas());
                    prim.focus();

                    controls.appendChild(prim.operatingSystemSelect);
                    controls.appendChild(prim.keyboardSelect);
                    controls.appendChild(prim.commandSystemSelect);
                    controls.appendChild(prim.tokenizerSelect);
                    controls.appendChild(prim.themeSelect);

                    onToggle(toggleLineNumbers, "ShowLineNumbers");
                    onToggle(toggleScrollBars, "ShowScrollBars");
                    onToggle(toggleWordWrap, "WordWrap");
                }
            });
        </script>
    </body>
</html>