<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
        <title>Primrose: Canvas-based text editor</title>
        <script type="text/javascript" src="../src/core.js"></script>
        <script type="text/javascript" src="../src/Cursor.js"></script>
        <script type="text/javascript" src="../src/Dimensions.js"></script>
        <script type="text/javascript" src="../src/Grammar.js"></script>
        <script type="text/javascript" src="../src/Keys.js"></script>
        <script type="text/javascript" src="../src/Primrose.js"></script>
        <script type="text/javascript" src="../src/code_pages/DE_QWERTZ.js"></script>
        <script type="text/javascript" src="../src/code_pages/EN_UKX.js"></script>
        <script type="text/javascript" src="../src/code_pages/EN_US.js"></script>
        <script type="text/javascript" src="../src/code_pages/FR_AZERTY.js"></script>
        <script type="text/javascript" src="../src/command_packs/Default.js"></script>
        <script type="text/javascript" src="../src/grammars/JavaScript.js"></script>
        <script type="text/javascript" src="../src/grammars/PlainText.js"></script>
        <script type="text/javascript" src="../src/operating_systems/OSX.js"></script>
        <script type="text/javascript" src="../src/operating_systems/Windows.js"></script>
        <script type="text/javascript" src="../src/renderers/Canvas.js"></script>
        <script type="text/javascript" src="../src/themes/Dark.js"></script>
        <script type="text/javascript" src="../src/themes/Default.js"></script>
        <style type="text/css">
            html, body{
                position:absolute;
                height:100%;
                width:100%;
                padding:0;
                margin:0;
            }
            #controls > div{
                display: inline-block;
                padding-right: 0.5em;
            }
        </style>
    </head>
    <body>
        <div style="position:absolute;height:100%;width:100%">
            <div id="controls" style="position:absolute;height:7em;width:100%">
                <div><input type="checkbox" id="toggleWordWrap"><label for="toggleWordWrap">Word wrap</label></div>
                <div><input type="checkbox" id="toggleLineNumbers"><label for="toggleLineNumbers">Line numbers</label></div>
                <div><input type="checkbox" id="toggleScrollBars"><label for="toggleScrollBars">Scroll bars</label></div>
            </div>
            <div style="position:absolute;top:2em;bottom:0;width:100%;">
                <canvas id="output" style="position:absolute;height:100%;width:100%;"></canvas>
            </div>
        </div>
        
        <script type="text/javascript">
            var prim, ctrls;

function demo() {

//123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789

    //////////////////////////////////////////////////////////////////
    // copied from: http://rosettacode.org/wiki/24_game#JavaScript  //
    //////////////////////////////////////////////////////////////////

    function twentyfour(numbers, input) {
        var invalidChars = /[^\d\+\*\/\s-\(\)]/;

        var validNums = function (str) {
            // Create a duplicate of our input numbers, so that
            // both lists will be sorted.
            var mnums = numbers.slice();
            mnums.sort();

            // Sort after mapping to numbers, to make comparisons valid.
            return str.replace(/[^\d\s]/g, " ")
                    .trim()
                    .split(/\s+/)
                    .map(function (n) {
                        return parseInt(n, 10);
                    })
                    .sort()
                    .every(function (v, i) {
                        return v === mnums[i];
                    });
        };

        var validEval = function (input) {
            try {
                return eval(input);
            } catch (e) {
                return {error: e.toString()};
            }
        };

        if (input.trim() === "")
            return "You must enter a value.";
        if (input.match(invalidChars))
            return "Invalid chars used, try again. Use only:\n + - * / ( )";
        if (!validNums(input))
            return "Wrong numbers used, try again.";
        var calc = validEval(input);
        if (typeof calc !== 'number')
            return "That is not a valid input; please try again.";
        if (calc !== 24)
            return "Wrong answer: " + String(calc) + "; please try again.";
        return input + " == 24.  Congratulations!";
    };

// I/O below.

    while (true) {
        var numbers = [1, 2, 3, 4].map(function () {
            return Math.floor(Math.random() * 8 + 1);
        });

        var input = prompt(
                "Your numbers are:\n" + numbers.join(" ") +
                "\nEnter expression. (use only + - * / and parens).\n", +"'x' to exit.", "");

        if (input === 'x') {
            break;
        }
        alert(twentyfour(numbers, input));
    }
}
                    
            function onToggle(e, f){
                e.addEventListener("change", function(){
                    prim["set" + f](e.checked);
                });
                e.checked = prim["get" + f]();
            }
                    
            window.addEventListener("load", function () {
                ctrls = findEverything();
                prim = new Primrose(ctrls.output, Renderers.Canvas, {
                    file: demo.toString(),
                    wordWrap: false
                });
                prim.focus();

                with(ctrls){
                    controls.appendChild(prim.operatingSystemSelect);
                    controls.appendChild(prim.keyboardSelect);
                    controls.appendChild(prim.commandSystemSelect);
                    controls.appendChild(prim.tokenizerSelect);
                    controls.appendChild(prim.themeSelect);

                    prim.placeSurrogateUnder(prim.getRenderer().getCanvas());

                    prim.bindEvents(window, output);
                    window.addEventListener("wheel", prim.readWheel.bind(prim));

                    onToggle(toggleLineNumbers, "ShowLineNumbers");
                    onToggle(toggleScrollBars, "ShowScrollBars");
                    onToggle(toggleWordWrap, "WordWrap");
                }
            });
        </script>
    </body>
</html>