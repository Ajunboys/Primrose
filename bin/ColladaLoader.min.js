THREE.ColladaLoader=function(){function a(a,c,d,e){var f=0;if(document.implementation&&document.implementation.createDocument){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(4===g.readyState){if(0===g.status||200===g.status)if(g.responseXML)Ra=c,b(g.responseXML,void 0,a);else if(g.responseText){Ra=c;var h=new DOMParser,i=h.parseFromString(g.responseText,"application/xml");b(i,void 0,a)}else e?e():console.error("ColladaLoader: Empty or non-existing file ("+a+")")}else 3===g.readyState&&d&&(0===f&&(f=g.getResponseHeader("Content-Length")),d({total:f,loaded:g.responseText.length}))},g.open("GET",a,!0),g.send(null)}else alert("Don't know how to parse XML!")}function b(a,b,c){if(Pa=a,b=b||Ra,void 0!==c){var i=c.split("/");i.pop(),Ma=(i.length<1?".":i.join("/"))+"/"}d(),za(),Ta=e("library_images image",F,"image"),Xa=e("library_materials material",Z,"material"),Ya=e("library_effects effect",ca,"effect"),Wa=e("library_geometries geometry",P,"geometry"),Za=e("library_cameras camera",ia,"camera"),$a=e("library_lights light",ka,"light"),Va=e("library_controllers controller",G,"controller"),Ua=e("library_animations animation",ea,"animation"),Ka=e("library_visual_scenes visual_scene",J,"visual_scene"),La=e("library_kinematics_models kinematics_model",ma,"kinematics_model"),Na=[],Oa=[],Ga=f(),Qa=new THREE.Group;for(var j=0;j<Ga.nodes.length;j++)Qa.add(u(Ga.nodes[j]));Qa.scale.multiplyScalar(bb),h(),Ha=g(),t();var k={scene:Qa,morphs:Na,skins:Oa,animations:Ia,kinematics:Ja,dae:{images:Ta,materials:Xa,cameras:Za,lights:$a,effects:Ya,geometries:Wa,controllers:Va,animations:Ua,visualScenes:Ka,visualScene:Ga,scene:Ga,kinematicsModels:La,kinematicsModel:Ha}};return b&&b(k),k}function c(a){_a=a}function d(){var a=Pa.querySelectorAll("asset"),b=a[0];if(b&&b.childNodes)for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes[c];switch(d.nodeName){case"unit":var e=d.getAttribute("meter");e&&(bb=parseFloat(e));break;case"up_axis":cb=d.textContent.charAt(0)}}}function e(a,b,c){for(var d=Pa.querySelectorAll(a),e={},f=0,g=d.length,h=0;g>h;h++){var i=d[h],j=(new b).parse(i);j.id&&0!==j.id.length||(j.id=c+f++),e[j.id]=j}return e}function f(){var a=Pa.querySelectorAll("scene instance_visual_scene")[0];if(a){var b=a.getAttribute("url").replace(/^#/,"");return Ka[b.length>0?b:"visual_scene0"]}return null}function g(){var a=Pa.querySelectorAll("instance_kinematics_model")[0];if(a){var b=a.getAttribute("url").replace(/^#/,"");return La[b.length>0?b:"kinematics_model0"]}return null}function h(){Ia=[],i(Qa)}function i(a){var b=Ga.getChildById(a.colladaId,!0),c=null;if(b&&b.keys){c={fps:60,hierarchy:[{node:b,keys:b.keys,sids:b.sids}],node:a,name:"animation_"+a.name,length:0},Ia.push(c);for(var d=0,e=b.keys.length;e>d;d++)c.length=Math.max(c.length,b.keys[d].time)}else c={hierarchy:[{keys:[],sids:[]}]};for(var d=0,e=a.children.length;e>d;d++)for(var f=i(a.children[d]),g=0,h=f.hierarchy.length;h>g;g++)c.hierarchy.push({keys:[],sids:[]});return c}function k(){var a,b=1e6,c=-b,d=0;for(var e in Ua){var f=Ua[e];a=a||f.id;for(var g=0;g<f.sampler.length;g++){var h=f.sampler[g];h.create(),b=Math.min(b,h.startTime),c=Math.max(c,h.endTime),d=Math.max(d,h.input.length)}}return{start:b,end:c,frames:d,ID:a}}function l(a,b){var c=b instanceof M?Va[b.url]:b;if(!c||!c.morph)return void console.log("could not find morph controller!");for(var d=c.morph,e=0;e<d.targets.length;e++){var f=d.targets[e],g=Wa[f];if(g.mesh&&g.mesh.primitives&&g.mesh.primitives.length){var h=g.mesh.primitives[0].geometry;h.vertices.length===a.vertices.length&&a.morphTargets.push({name:"target_1",vertices:h.vertices})}}a.morphTargets.push({name:"target_Z",vertices:a.vertices})}function m(a,b,c,d){if(a.world=a.world||new THREE.Matrix4,a.localworld=a.localworld||new THREE.Matrix4,a.world.copy(a.matrix),a.localworld.copy(a.matrix),a.channels&&a.channels.length){var e=a.channels[0],f=e.sampler.output[c];f instanceof THREE.Matrix4&&(a.world.copy(f),a.localworld.copy(f),0===c&&a.matrix.copy(f))}d&&a.world.multiplyMatrices(d,a.world),b.push(a);for(var g=0;g<a.nodes.length;g++)m(a.nodes[g],b,c,a.world)}function n(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=-1;if("JOINT"==d.type){for(var f=0;f<b.joints.length;f++)if(d.sid===b.joints[f]){e=f;break}if(e>=0){var g=b.invBindMatrices[e];d.invBindMatrix=g,d.skinningMatrix=new THREE.Matrix4,d.skinningMatrix.multiplyMatrices(d.world,g),d.animatrix=new THREE.Matrix4,d.animatrix.copy(d.localworld),d.weights=[];for(var f=0;f<b.weights.length;f++)for(var h=0;h<b.weights[f].length;h++){var i=b.weights[f][h];i.joint===e&&d.weights.push(i)}}else console.warn("ColladaLoader: Could not find joint '"+d.sid+"'."),d.skinningMatrix=new THREE.Matrix4,d.weights=[]}}}function p(a){var b=[],c=function(a,b,d){var e={};e.name=b.sid,e.parent=a,e.matrix=b.matrix;var f=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];e.matrix.decompose(f[0],f[1],f[2]),e.pos=[f[0].x,f[0].y,f[0].z],e.scl=[f[2].x,f[2].y,f[2].z],e.rotq=[f[1].x,f[1].y,f[1].z,f[1].w],d.push(e);for(var g in b.nodes)c(b.sid,b.nodes[g],d)};return c(-1,a,b),b}function q(a,b,c){var d=[];m(b,d,-1),n(d,c.skin),v=new THREE.Vector3;for(var e=[],f=0;f<a.vertices.length;f++)e.push(new THREE.Vector3);for(f=0;f<d.length;f++)if("JOINT"==d[f].type)for(j=0;j<d[f].weights.length;j++)w=d[f].weights[j],vidx=w.index,weight=w.weight,o=a.vertices[vidx],s=e[vidx],v.x=o.x,v.y=o.y,v.z=o.z,v.applyMatrix4(d[f].skinningMatrix),s.x+=v.x*weight,s.y+=v.y*weight,s.z+=v.z*weight;for(var f=0;f<a.vertices.length;f++)a.vertices[f]=e[f]}function r(a,b,c){var d=Va[b.url];if(c=void 0!==c?c:40,!d||!d.skin)return void console.log("ColladaLoader: Could not find skin controller.");if(!b.skeleton||!b.skeleton.length)return void console.log("ColladaLoader: Could not find the skeleton for the skin. ");for(var e=k(),f=Ga.getChildById(b.skeleton[0],!0)||Ga.getChildBySid(b.skeleton[0],!0),g=p(f),h=d.skin.joints,i=[],j=0;j<h.length;j++)for(var l=0;l<g.length;l++)g[l].name===h[j]&&(i[j]=g[l]);for(var j=0;j<i.length;j++)for(var l=0;l<i.length;l++)i[j].parent===i[l].name&&(i[j].parent=l);{var j,l,o;new THREE.Vector3}for(j=0;j<a.vertices.length;j++)a.vertices[j].applyMatrix4(d.skin.bindShapeMatrix);for(var r=[],s=[],t=d.skin.weights,j=0;j<t.length;j++){var u=new THREE.Vector4(t[j][0]?t[j][0].joint:0,t[j][1]?t[j][1].joint:0,t[j][2]?t[j][2].joint:0,t[j][3]?t[j][3].joint:0),o=new THREE.Vector4(t[j][0]?t[j][0].weight:0,t[j][1]?t[j][1].weight:0,t[j][2]?t[j][2].weight:0,t[j][3]?t[j][3].weight:0);r.push(u),s.push(o)}a.skinIndices=r,a.skinWeights=s,a.bones=i;for(var v={name:e.ID,fps:30,length:e.frames/30,hierarchy:[]},l=0;l<i.length;l++)v.hierarchy.push({parent:i[l].parent,name:i[l].name,keys:[]});for(console.log("ColladaLoader:",e.ID+" has "+i.length+" bones."),q(a,f,d),c=0;c<e.frames;c++){var w=[];m(f,w,c),n(w,d.skin);for(var j=0;j<w.length;j++)for(var l=0;l<v.hierarchy.length;l++)if(v.hierarchy[l].name===w[j].sid){var x={};x.time=c/30,x.matrix=w[j].animatrix,0===c&&(w[j].matrix=x.matrix);var y=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];x.matrix.decompose(y[0],y[1],y[2]),x.pos=[y[0].x,y[0].y,y[0].z],x.scl=[y[2].x,y[2].y,y[2].z],x.rot=y[1],v.hierarchy[l].keys.push(x)}a.animation=v}}function t(){if(Ha&&0===Ha.joints.length)return void(Ja=void 0);var a={},b=function(b,c){var d=c.getAttribute("id"),e=Ga.getChildById(d,!0),f=Ha.joints[b];Qa.traverse(function(c){c.colladaId==d&&(a[b]={node:c,transforms:e.transforms,joint:f,position:f.zeroPosition})})};Ja={joints:Ha&&Ha.joints,getJointValue:function(b){var c=a[b];return c?c.position:void console.log("getJointValue: joint "+b+" doesn't exist")},setJointValue:function(b,c){var e=a[b];if(e){var f=e.joint;if(c>f.limits.max||c<f.limits.min)console.log("setJointValue: joint "+b+" value "+c+" outside of limits (min: "+f.limits.min+", max: "+f.limits.max+")");else if(f["static"])console.log("setJointValue: joint "+b+" is static");else{var g=e.node,h=f.axis,i=e.transforms,j=new THREE.Matrix4;for(d=0;d<i.length;d++){var k=i[d];if(k.sid&&-1!==k.sid.indexOf("joint"+b))switch(f.type){case"revolute":j.multiply(l.makeRotationAxis(h,THREE.Math.degToRad(c)));break;case"prismatic":j.multiply(l.makeTranslation(h.x*c,h.y*c,h.z*c));break;default:console.warn("setJointValue: unknown joint type: "+f.type)}else{var l=new THREE.Matrix4;switch(k.type){case"matrix":j.multiply(k.obj);break;case"translate":j.multiply(l.makeTranslation(k.obj.x,k.obj.y,k.obj.z));break;case"rotate":j.multiply(l.makeRotationAxis(k.obj,k.angle))}}}var m=j.elements,n=Array.prototype.slice.call(m),o=[n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15]];g.matrix.set.apply(g.matrix,o),g.matrix.decompose(g.position,g.quaternion,g.scale)}}else console.log("setJointValue: joint "+b+" doesn't exist")}};var c=Pa.querySelector("scene instance_kinematics_scene");if(c)for(var d=0;d<c.childNodes.length;d++){var e=c.childNodes[d];if(1==e.nodeType)switch(e.nodeName){case"bind_joint_axis":var f=e.getAttribute("target").split("/").pop(),g=e.querySelector("axis param").textContent,h=parseInt(g.split("joint").pop().split(".")[0]),i=Pa.querySelector('[sid="'+f+'"]');if(i){var j=i.parentElement;b(h,j)}}}}function u(a,b){var c,d,e,f,g=new THREE.Object3D,h=!1;for(e=0;e<a.controllers.length;e++){var i=Va[a.controllers[e].url];switch(i.type){case"skin":if(Wa[i.skin.source]){var j=new O;j.url=i.skin.source,j.instance_material=a.controllers[e].instance_material,a.geometries.push(j),h=!0,c=a.controllers[e]}else if(Va[i.skin.source]){var k=Va[i.skin.source];if(d=k,k.morph&&Wa[k.morph.source]){var j=new O;j.url=k.morph.source,j.instance_material=a.controllers[e].instance_material,a.geometries.push(j)}}break;case"morph":if(Wa[i.morph.source]){var j=new O;j.url=i.morph.source,j.instance_material=a.controllers[e].instance_material,a.geometries.push(j),d=a.controllers[e]}console.log("ColladaLoader: Morph-controller partially supported.")}}var m={};for(e=0;e<a.geometries.length;e++){var n,o=a.geometries[e],p=o.instance_material,q=Wa[o.url],s={},t=[],v=0;if(q){if(!q.mesh||!q.mesh.primitives)continue;if(0===g.name.length&&(g.name=q.id),p)for(f=0;f<p.length;f++){var w=p[f],x=Xa[w.target],y=x.instance_effect.url,z=Ya[y].shader,A=z.material;if(q.doubleSided){if(!(w.symbol in m)){var B=A.clone();B.side=THREE.DoubleSide,m[w.symbol]=B}A=m[w.symbol]}A.opacity=A.opacity?A.opacity:1,s[w.symbol]=v,t.push(A),n=A,n.name=null===x.name||""===x.name?x.id:x.name,v++}var C,D=n||new THREE.MeshLambertMaterial({color:14540253,side:q.doubleSided?THREE.DoubleSide:THREE.FrontSide}),E=q.mesh.geometry3js;v>1&&(D=new THREE.MeshFaceMaterial(t)),void 0!==c?(r(E,c),E.morphTargets.length>0?(D.morphTargets=!0,D.skinning=!1):(D.morphTargets=!1,D.skinning=!0),C=new THREE.SkinnedMesh(E,D,!1),C.name="skin_"+Oa.length,Oa.push(C)):void 0!==d?(l(E,d),D.morphTargets=!0,C=new THREE.Mesh(E,D),C.name="morph_"+Na.length,Na.push(C)):C=E.isLineStrip===!0?new THREE.Line(E):new THREE.Mesh(E,D),g.add(C)}}for(e=0;e<a.cameras.length;e++){var F=a.cameras[e],G=Za[F.url],H=new THREE.PerspectiveCamera(G.yfov,parseFloat(G.aspect_ratio),parseFloat(G.znear),parseFloat(G.zfar));g.add(H)}for(e=0;e<a.lights.length;e++){var I=null,J=a.lights[e],K=$a[J.url];if(K&&K.technique){var L,M=K.color.getHex(),N=K.intensity,P=K.distance,Q=K.falloff_angle;switch(K.technique){case"directional":I=new THREE.DirectionalLight(M,N,P),I.position.set(0,0,1);break;case"point":I=new THREE.PointLight(M,N,P);break;case"spot":I=new THREE.SpotLight(M,N,P,Q,L),I.position.set(0,0,1);break;case"ambient":I=new THREE.AmbientLight(M)}}I&&g.add(I)}if(g.name=a.name||a.id||"",g.colladaId=a.id||"",g.layer=a.layer||"",g.matrix=a.matrix,g.matrix.decompose(g.position,g.quaternion,g.scale),ab.centerGeometry&&g.geometry){var R=g.geometry.center();R.multiply(g.scale),R.applyQuaternion(g.quaternion),g.position.sub(R)}for(e=0;e<a.nodes.length;e++)g.add(u(a.nodes[e],a));return g}function x(a){for(var b=Pa.querySelectorAll("library_nodes node"),c=0;c<b.length;c++){var d=b[c].attributes.getNamedItem("id");if(d&&d.value===a)return b[c]}return void 0}function y(a){var b=[],c=1e6,d=-1e6;for(var e in Ua)for(var f=Ua[e],g=0;g<f.channel.length;g++){var h=f.channel[g],i=f.sampler[g],e=h.target.split("/")[0];e==a.id&&(i.create(),h.sampler=i,c=Math.min(c,i.startTime),d=Math.max(d,i.endTime),b.push(h))}return b.length&&(a.startTime=c,a.endTime=d),b}function z(a){if(a.channels&&a.channels.length){for(var b=[],c=[],d=0,e=a.channels.length;e>d;d++){var f,g=a.channels[d],h=g.fullSid,i=g.sampler,j=i.input,k=a.getTransformBySid(g.sid);if(g.arrIndices){f=[];for(var l=0,m=g.arrIndices.length;m>l;l++)f[l]=Ea(g.arrIndices[l])}else f=Fa(g.member);if(k){-1===c.indexOf(h)&&c.push(h);for(var l=0,m=j.length;m>l;l++){var n=j[l],o=i.getData(k.type,l,f),p=A(b,n);if(!p){p=new ha(n);var q=B(b,n);b.splice(-1===q?b.length:q,0,p)}p.addTarget(h,k,f,o)}}else console.log('Could not find transform "'+g.sid+'" in node '+a.id)}for(var d=0;d<c.length;d++)for(var r=c[d],l=0;l<b.length;l++){var p=b[l];p.hasTarget(r)||C(b,p,l,r)}a.keys=b,a.sids=c}}function A(a,b){for(var c=null,d=0,e=a.length;e>d&&null===c;d++){var f=a[d];if(f.time===b)c=f;else if(f.time>b)break}return c}function B(a,b){for(var c=-1,d=0,e=a.length;e>d&&-1===c;d++){var f=a[d];f.time>=b&&(c=d)}return c}function C(a,b,c,d){var e=E(a,d,c?c-1:0),f=D(a,d,c+1);if(e&&f){var g,h=(b.time-e.time)/(f.time-e.time),i=e.getTarget(d),j=f.getTarget(d).data,k=i.data;if("matrix"===i.type)g=k;else if(k.length){g=[];for(var l=0;l<k.length;++l)g[l]=k[l]+(j[l]-k[l])*h}else g=k+(j-k)*h;b.addTarget(d,i.transform,i.member,g)}}function D(a,b,c){for(;c<a.length;c++){var d=a[c];if(d.hasTarget(b))return d}return null}function E(a,b,c){for(c=c>=0?c:c+a.length;c>=0;c--){var d=a[c];if(d.hasTarget(b))return d}return null}function F(){this.id="",this.init_from=""}function G(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function H(){this.method=null,this.source=null,this.targets=null,this.weights=null}function I(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function J(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Group}function K(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function L(){this.sid="",this.type="",this.data=[],this.obj=null}function M(){this.url="",this.skeleton=[],this.instance_material=[]}function N(){this.symbol="",this.target=""}function O(){this.url="",this.instance_material=[]}function P(){this.id="",this.mesh=null}function Q(a){this.geometry=a.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function R(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function S(){R.call(this),this.vcount=[]}function T(){R.call(this),this.vcount=1}function U(){R.call(this),this.vcount=3}function V(){this.source="",this.count=0,this.stride=0,this.params=[]}function W(){this.input={}}function X(){this.semantic="",this.offset=0,this.source="",this.set=0}function Y(a){this.id=a,this.type=null}function Z(){this.id="",this.name="",this.instance_effect=null}function $(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function _(a,b){this.type=a,this.effect=b,this.material=null}function aa(a){this.effect=a,this.init_from=null,this.format=null}function ba(a){this.effect=a,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function ca(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function da(){this.url=""}function ea(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function fa(a){this.animation=a,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function ga(a){this.id="",this.animation=a,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function ha(a){this.targets=[],this.time=a}function ia(){this.id="",this.name="",this.technique=""}function ja(){this.url=""}function ka(){this.id="",this.name="",this.technique=""}function la(){this.url=""}function ma(){this.id="",this.name="",this.joints=[],this.links=[]}function na(){this.sid="",this.name="",this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this["static"]=!1,this.zeroPosition=0,this.middlePosition=0}function oa(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function pa(){this.joint="",this.transforms=[],this.links=[]}function qa(a){var b=a.getAttribute("id");return void 0!=Sa[b]?Sa[b]:(Sa[b]=new Y(b).parse(a),Sa[b])}function ra(a){for(var b=ua(a),c=[],d=0,e=b.length;e>d;d++)c.push("true"===b[d]||"1"===b[d]?!0:!1);return c}function sa(a){for(var b=ua(a),c=[],d=0,e=b.length;e>d;d++)c.push(parseFloat(b[d]));return c}function ta(a){for(var b=ua(a),c=[],d=0,e=b.length;e>d;d++)c.push(parseInt(b[d],10));return c}function ua(a){return a.length>0?va(a).split(/\s+/):[]}function va(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}function wa(a,b,c){return a.hasAttribute(b)?parseInt(a.getAttribute(b),10):c}function xa(a,b){loader=new THREE.ImageLoader,loader.load(b,function(b){a.image=b,a.needsUpdate=!0})}function ya(a,b){a.doubleSided=!1;var c=b.querySelectorAll("extra double_sided")[0];c&&c&&1===parseInt(c.textContent,10)&&(a.doubleSided=!0)}function za(){if(ab.convertUpAxis!==!0||cb===ab.upAxis)db=null;else switch(cb){case"X":db="Y"===ab.upAxis?"XtoY":"XtoZ";break;case"Y":db="X"===ab.upAxis?"YtoX":"YtoZ";break;case"Z":db="X"===ab.upAxis?"ZtoX":"ZtoY"}}function Aa(a,b){if(ab.convertUpAxis===!0&&cb!==ab.upAxis)switch(db){case"XtoY":var c=a[0];a[0]=b*a[1],a[1]=c;break;case"XtoZ":var c=a[2];a[2]=a[1],a[1]=a[0],a[0]=c;break;case"YtoX":var c=a[0];a[0]=a[1],a[1]=b*c;break;case"YtoZ":var c=a[1];a[1]=b*a[2],a[2]=c;break;case"ZtoX":var c=a[0];a[0]=a[1],a[1]=a[2],a[2]=c;break;case"ZtoY":var c=a[1];a[1]=a[2],a[2]=b*c}}function Ba(a,b){if(ab.convertUpAxis!==!0||cb===ab.upAxis)return b;switch(a){case"X":b="XtoY"===db?-1*b:b;break;case"Y":b="YtoZ"===db||"YtoX"===db?-1*b:b;break;case"Z":b="ZtoY"===db?-1*b:b}return b}function Ca(a,b){var c=[a[b],a[b+1],a[b+2]];return Aa(c,-1),new THREE.Vector3(c[0],c[1],c[2])}function Da(a){if(ab.convertUpAxis){var b=[a[0],a[4],a[8]];Aa(b,-1),a[0]=b[0],a[4]=b[1],a[8]=b[2],b=[a[1],a[5],a[9]],Aa(b,-1),a[1]=b[0],a[5]=b[1],a[9]=b[2],b=[a[2],a[6],a[10]],Aa(b,-1),a[2]=b[0],a[6]=b[1],a[10]=b[2],b=[a[0],a[1],a[2]],Aa(b,-1),a[0]=b[0],a[1]=b[1],a[2]=b[2],b=[a[4],a[5],a[6]],Aa(b,-1),a[4]=b[0],a[5]=b[1],a[6]=b[2],b=[a[8],a[9],a[10]],Aa(b,-1),a[8]=b[0],a[9]=b[1],a[10]=b[2],b=[a[3],a[7],a[11]],Aa(b,-1),a[3]=b[0],a[7]=b[1],a[11]=b[2]}return(new THREE.Matrix4).set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}function Ea(a){if(a>-1&&3>a){var b=["X","Y","Z"],c={X:0,Y:1,Z:2};a=Fa(b[a]),a=c[a]}return a}function Fa(a){if(ab.convertUpAxis)switch(a){case"X":switch(db){case"XtoY":case"XtoZ":case"YtoX":a="Y";break;case"ZtoX":a="Z"}break;case"Y":switch(db){case"XtoY":case"YtoX":case"ZtoX":a="X";break;case"XtoZ":case"YtoZ":case"ZtoY":a="Z"}break;case"Z":switch(db){case"XtoZ":a="X";break;case"YtoZ":case"ZtoX":case"ZtoY":a="Y"}}return a}var Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa=null,Qa=null,Ra=null,Sa={},Ta={},Ua={},Va={},Wa={},Xa={},Ya={},Za={},$a={},_a=THREE.SmoothShading,ab={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},bb=1,cb="Y",db=null;return F.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];"init_from"===c.nodeName&&(this.init_from=c.textContent)}return this},G.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.type="none";for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"skin":this.skin=(new I).parse(c),this.type=c.nodeName;break;case"morph":this.morph=(new H).parse(c),this.type=c.nodeName}}return this},H.prototype.parse=function(a){var b,c={},d=[];for(this.method=a.getAttribute("method"),this.source=a.getAttribute("source").replace(/^#/,""),b=0;b<a.childNodes.length;b++){var e=a.childNodes[b];if(1==e.nodeType)switch(e.nodeName){case"source":var f=(new Y).parse(e);c[f.id]=f;break;case"targets":d=this.parseInputs(e);break;default:console.log(e.nodeName)}}for(b=0;b<d.length;b++){var g=d[b],f=c[g.source];switch(g.semantic){case"MORPH_TARGET":this.targets=f.read();break;case"MORPH_WEIGHT":this.weights=f.read()}}return this},H.prototype.parseInputs=function(a){for(var b=[],c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"input":b.push((new X).parse(d))}}return b},I.prototype.parse=function(a){var b,c,d={};this.source=a.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var e=0;e<a.childNodes.length;e++){var f=a.childNodes[e];if(1==f.nodeType)switch(f.nodeName){case"bind_shape_matrix":var g=sa(f.textContent);this.bindShapeMatrix=Da(g);break;case"source":var h=(new Y).parse(f);d[h.id]=h;break;case"joints":b=f;break;case"vertex_weights":c=f;break;default:console.log(f.nodeName)}}return this.parseJoints(b,d),this.parseWeights(c,d),this},I.prototype.parseJoints=function(a,b){for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"input":var e=(new X).parse(d),f=b[e.source];"JOINT"===e.semantic?this.joints=f.read():"INV_BIND_MATRIX"===e.semantic&&(this.invBindMatrices=f.read())}}},I.prototype.parseWeights=function(a,b){for(var c,d,e=[],f=0;f<a.childNodes.length;f++){var g=a.childNodes[f];if(1==g.nodeType)switch(g.nodeName){case"input":e.push((new X).parse(g));break;case"v":c=ta(g.textContent);break;case"vcount":d=ta(g.textContent)}}for(var h=0,f=0;f<d.length;f++){for(var i=d[f],j=[],k=0;i>k;k++){for(var l={},m=0;m<e.length;m++){var n=e[m],o=c[h+n.offset];switch(n.semantic){case"JOINT":l.joint=o;break;case"WEIGHT":l.weight=b[n.source].data[o]}}j.push(l),h+=e.length}for(var k=0;k<j.length;k++)j[k].index=f;this.weights.push(j)}},J.prototype.getChildById=function(a,b){for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildById(a,b);if(d)return d}return null},J.prototype.getChildBySid=function(a,b){for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildBySid(a,b);if(d)return d}return null},J.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.nodes=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"node":this.nodes.push((new K).parse(c))}}return this},K.prototype.getChannelForTransform=function(a){for(var b=0;b<this.channels.length;b++){var c,d,e=this.channels[b],f=e.target.split("/"),g=(f.shift(),f.shift()),h=g.indexOf(".")>=0,i=g.indexOf("(")>=0;if(h)f=g.split("."),g=f.shift(),d=f.shift();else if(i){c=g.split("("),g=c.shift();for(var j=0;j<c.length;j++)c[j]=parseInt(c[j].replace(/\)/,""))}if(g===a)return e.info={sid:g,dotSyntax:h,arrSyntax:i,arrIndices:c},e}return null},K.prototype.getChildById=function(a,b){if(this.id===a)return this;if(b)for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildById(a,b);if(d)return d}return null},K.prototype.getChildBySid=function(a,b){if(this.sid===a)return this;if(b)for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c].getChildBySid(a,b);if(d)return d}return null},K.prototype.getTransformBySid=function(a){for(var b=0;b<this.transforms.length;b++)if(this.transforms[b].sid===a)return this.transforms[b];return null},K.prototype.parse=function(a){var b;this.id=a.getAttribute("id"),this.sid=a.getAttribute("sid"),this.name=a.getAttribute("name"),this.type=a.getAttribute("type"),this.layer=a.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"node":this.nodes.push((new K).parse(d));break;case"instance_camera":this.cameras.push((new ja).parse(d));break;case"instance_controller":this.controllers.push((new M).parse(d));break;case"instance_geometry":this.geometries.push((new O).parse(d));break;case"instance_light":this.lights.push((new la).parse(d));break;case"instance_node":b=d.getAttribute("url").replace(/^#/,"");var e=x(b);e&&this.nodes.push((new K).parse(e));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new L).parse(d));break;case"extra":break;default:console.log(d.nodeName)}}return this.channels=y(this),z(this),this.updateMatrix(),this},K.prototype.updateMatrix=function(){this.matrix.identity();for(var a=0;a<this.transforms.length;a++)this.transforms[a].apply(this.matrix)},L.prototype.parse=function(a){return this.sid=a.getAttribute("sid"),this.type=a.nodeName,this.data=sa(a.textContent),this.convert(),this},L.prototype.convert=function(){switch(this.type){case"matrix":this.obj=Da(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":Aa(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Aa(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},L.prototype.apply=function(){var a=new THREE.Matrix4;return function(b){switch(this.type){case"matrix":b.multiply(this.obj);break;case"translate":b.multiply(a.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":b.multiply(a.makeRotationAxis(this.obj,this.angle));break;case"scale":b.scale(this.obj)}}}(),L.prototype.update=function(a,b){var c=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(b)if(1===b.length)switch(b[0]){case 0:this.obj.n11=a[0],this.obj.n21=a[1],this.obj.n31=a[2],this.obj.n41=a[3];break;case 1:this.obj.n12=a[0],this.obj.n22=a[1],this.obj.n32=a[2],this.obj.n42=a[3];break;case 2:this.obj.n13=a[0],this.obj.n23=a[1],this.obj.n33=a[2],this.obj.n43=a[3];break;case 3:this.obj.n14=a[0],this.obj.n24=a[1],this.obj.n34=a[2],this.obj.n44=a[3]}else if(2===b.length){var d="n"+(b[0]+1)+(b[1]+1);this.obj[d]=a}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(a);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(b)&&(b=c[b[0]]),b){case"X":this.obj.x=a;break;case"Y":this.obj.y=a;break;case"Z":this.obj.z=a;break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(b)&&(b=c[b[0]]),b){case"X":this.obj.x=a;break;case"Y":this.obj.y=a;break;case"Z":this.obj.z=a;break;case"ANGLE":this.angle=THREE.Math.degToRad(a);break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2],this.angle=THREE.Math.degToRad(a[3])}}},M.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1===c.nodeType)switch(c.nodeName){case"skeleton":this.skeleton.push(c.textContent.replace(/^#/,""));break;case"bind_material":for(var d=c.querySelectorAll("instance_material"),e=0;e<d.length;e++){var f=d[e];this.instance_material.push((new N).parse(f))}break;case"extra":}}return this},N.prototype.parse=function(a){return this.symbol=a.getAttribute("symbol"),this.target=a.getAttribute("target").replace(/^#/,""),this},O.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType&&"bind_material"===c.nodeName){for(var d=c.querySelectorAll("instance_material"),e=0;e<d.length;e++){var f=d[e];this.instance_material.push((new N).parse(f))}break}}return this},P.prototype.parse=function(a){this.id=a.getAttribute("id"),ya(this,a);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"mesh":this.mesh=new Q(this).parse(c);break;case"extra":}}return this},Q.prototype.parse=function(a){this.primitives=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"source":qa(c);break;case"vertices":this.vertices=(new W).parse(c);break;case"linestrips":this.primitives.push((new T).parse(c));break;case"triangles":this.primitives.push((new U).parse(c));break;case"polygons":this.primitives.push((new R).parse(c));break;case"polylist":this.primitives.push((new S).parse(c))}}if(this.geometry3js=new THREE.Geometry,null===this.vertices)return this;for(var d=Sa[this.vertices.input.POSITION.source].data,b=0;b<d.length;b+=3)this.geometry3js.vertices.push(Ca(d,b).clone());for(var b=0;b<this.primitives.length;b++){var e=this.primitives[b];e.setVertices(this.vertices),this.handlePrimitive(e,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},Q.prototype.handlePrimitive=function(a,b){if(a instanceof T)return void(b.isLineStrip=!0);var c,d,e,f,g,h,i,j=a.p,k=a.inputs,l=0,m=3,n=0,o=[];for(c=0;c<k.length;c++){e=k[c];var p=e.offset+1;switch(n=p>n?p:n,e.semantic){case"TEXCOORD":o.push(e.set)}}for(var q=0;q<j.length;++q)for(var r=j[q],s=0;s<r.length;){var t=[],u=[],v=null,w=[];for(m=a.vcount?a.vcount.length?a.vcount[l++]:a.vcount:r.length/n,c=0;m>c;c++)for(d=0;d<k.length;d++)switch(e=k[d],h=Sa[e.source],f=r[s+c*n+e.offset],i=h.accessor.params.length,g=f*i,e.semantic){case"VERTEX":t.push(f);break;case"NORMAL":u.push(Ca(h.data,g));break;case"TEXCOORD":v=v||{},void 0===v[e.set]&&(v[e.set]=[]),v[e.set].push(new THREE.Vector2(h.data[g],h.data[g+1]));break;case"COLOR":w.push((new THREE.Color).setRGB(h.data[g],h.data[g+1],h.data[g+2]))}if(0===u.length)if(e=this.vertices.input.NORMAL){h=Sa[e.source],i=h.accessor.params.length;for(var x=0,y=t.length;y>x;x++)u.push(Ca(h.data,t[x]*i))}else b.calcNormals=!0;if(!v&&(v={},e=this.vertices.input.TEXCOORD)){o.push(e.set),h=Sa[e.source],i=h.accessor.params.length;for(var x=0,y=t.length;y>x;x++)g=t[x]*i,void 0===v[e.set]&&(v[e.set]=[]),v[e.set].push(new THREE.Vector2(h.data[g],1-h.data[g+1]))}if(0===w.length&&(e=this.vertices.input.COLOR)){h=Sa[e.source],i=h.accessor.params.length;for(var x=0,y=t.length;y>x;x++)g=t[x]*i,w.push((new THREE.Color).setRGB(h.data[g],h.data[g+1],h.data[g+2]))}var z,A,B=null,C=[];if(3===m)C.push(new THREE.Face3(t[0],t[1],t[2],u,w.length?w:new THREE.Color));else if(4===m)C.push(new THREE.Face3(t[0],t[1],t[3],[u[0].clone(),u[1].clone(),u[3].clone()],w.length?[w[0],w[1],w[3]]:new THREE.Color)),C.push(new THREE.Face3(t[1],t[2],t[3],[u[1].clone(),u[2].clone(),u[3].clone()],w.length?[w[1],w[2],w[3]]:new THREE.Color));else if(m>4&&ab.subdivideFaces){var D=w.length?w:new THREE.Color;for(d=1;m-1>d;)C.push(new THREE.Face3(t[0],t[d],t[d+1],[u[0].clone(),u[d++].clone(),u[d].clone()],D))}if(C.length)for(var x=0,y=C.length;y>x;x++)for(B=C[x],B.daeMaterial=a.material,b.faces.push(B),d=0;d<o.length;d++)z=v[o[d]],A=m>4?[z[0],z[x+1],z[x+2]]:4===m?0===x?[z[0],z[1],z[3]]:[z[1].clone(),z[2],z[3].clone()]:[z[0],z[1],z[2]],void 0===b.faceVertexUvs[d]&&(b.faceVertexUvs[d]=[]),b.faceVertexUvs[d].push(A);else console.log("dropped face with vcount "+m+" for geometry with id: "+b.id);s+=n*m}},R.prototype.setVertices=function(a){for(var b=0;b<this.inputs.length;b++)this.inputs[b].source===a.id&&(this.inputs[b].source=a.input.POSITION.source)},R.prototype.parse=function(a){this.material=a.getAttribute("material"),this.count=wa(a,"count",0);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"input":this.inputs.push((new X).parse(a.childNodes[b]));break;case"vcount":this.vcount=ta(c.textContent);break;case"p":this.p.push(ta(c.textContent));

break;case"ph":console.warn("polygon holes not yet supported!")}}return this},S.prototype=Object.create(R.prototype),S.prototype.constructor=S,T.prototype=Object.create(R.prototype),T.prototype.constructor=T,U.prototype=Object.create(R.prototype),U.prototype.constructor=U,V.prototype.parse=function(a){this.params=[],this.source=a.getAttribute("source"),this.count=wa(a,"count",0),this.stride=wa(a,"stride",0);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if("param"===c.nodeName){var d={};d.name=c.getAttribute("name"),d.type=c.getAttribute("type"),this.params.push(d)}}return this},W.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++)if("input"===a.childNodes[b].nodeName){var c=(new X).parse(a.childNodes[b]);this.input[c.semantic]=c}return this},X.prototype.parse=function(a){return this.semantic=a.getAttribute("semantic"),this.source=a.getAttribute("source").replace(/^#/,""),this.set=wa(a,"set",-1),this.offset=wa(a,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},Y.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"bool_array":this.data=ra(c.textContent),this.type=c.nodeName;break;case"float_array":this.data=sa(c.textContent),this.type=c.nodeName;break;case"int_array":this.data=ta(c.textContent),this.type=c.nodeName;break;case"IDREF_array":case"Name_array":this.data=ua(c.textContent),this.type=c.nodeName;break;case"technique_common":for(var d=0;d<c.childNodes.length;d++)if("accessor"===c.childNodes[d].nodeName){this.accessor=(new V).parse(c.childNodes[d]);break}}}return this},Y.prototype.read=function(){var a=[],b=this.accessor.params[0];switch(b.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var c=0;c<this.data.length;c+=16){var d=this.data.slice(c,c+16),e=Da(d);a.push(e)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+b.type+".")}return a},Z.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++)if("instance_effect"===a.childNodes[b].nodeName){this.instance_effect=(new da).parse(a.childNodes[b]);break}return this},$.prototype.isColor=function(){return null===this.texture},$.prototype.isTexture=function(){return null!=this.texture},$.prototype.parse=function(a){"transparent"===a.nodeName&&(this.opaque=a.getAttribute("opaque"));for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"color":var d=sa(c.textContent);this.color=new THREE.Color,this.color.setRGB(d[0],d[1],d[2]),this.color.a=d[3];break;case"texture":this.texture=c.getAttribute("texture"),this.texcoord=c.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(c)}}return this},$.prototype.parseTexture=function(a){if(!a.childNodes)return this;a.childNodes[1]&&"extra"===a.childNodes[1].nodeName&&(a=a.childNodes[1],a.childNodes[1]&&"technique"===a.childNodes[1].nodeName&&(a=a.childNodes[1]));for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[c.nodeName]=parseFloat(c.textContent);break;case"wrapU":case"wrapV":"TRUE"===c.textContent.toUpperCase()?this.texOpts[c.nodeName]=1:this.texOpts[c.nodeName]=parseInt(c.textContent);break;default:this.texOpts[c.nodeName]=c.textContent}}return this},_.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[c.nodeName]=(new $).parse(c);break;case"bump":var d=c.getAttribute("bumptype");d?"heightfield"===d.toLowerCase()?this.bump=(new $).parse(c):"normalmap"===d.toLowerCase()?this.normal=(new $).parse(c):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+d+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new $).parse(c)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new $).parse(c));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var e=c.querySelectorAll("float");e.length>0&&(this[c.nodeName]=parseFloat(e[0].textContent))}}return this.create(),this},_.prototype.create=function(){var a={},b=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var c=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);c>0&&(b=!0,a.transparent=!0,a.opacity=1-c)}var d={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var e in this)switch(e){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var f=this[e];if(f instanceof $)if(f.isTexture()){var g=f.texture,h=this.effect.sampler[g];if(void 0!==h&&void 0!==h.source){var i=this.effect.surface[h.source];if(void 0!==i){var j=Ta[i.init_from];if(j){var k,l=Ma+j.init_from,m=THREE.Loader.Handlers.get(l);null!==m?k=m.load(l):(k=new THREE.Texture,xa(k,l)),k.wrapS=f.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,k.wrapT=f.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,k.offset.x=f.texOpts.offsetU,k.offset.y=f.texOpts.offsetV,k.repeat.x=f.texOpts.repeatU,k.repeat.y=f.texOpts.repeatV,a[d[e]]=k,"emission"===e&&(a.emissive=16777215)}}}}else"diffuse"!==e&&b||("emission"===e?a.emissive=f.color.getHex():a[e]=f.color.getHex());break;case"shininess":a[e]=this[e];break;case"reflectivity":a[e]=this[e],a[e]>0&&(a.envMap=ab.defaultEnvMap),a.combine=THREE.MixOperation;break;case"index_of_refraction":a.refractionRatio=this[e],1!==this[e]&&(a.envMap=ab.defaultEnvMap);break;case"transparency":}switch(a.shading=_a,a.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.type){case"constant":void 0!=a.emissive&&(a.color=a.emissive),this.material=new THREE.MeshBasicMaterial(a);break;case"phong":case"blinn":void 0!=a.diffuse&&(a.color=a.diffuse),this.material=new THREE.MeshPhongMaterial(a);break;case"lambert":default:void 0!=a.diffuse&&(a.color=a.diffuse),this.material=new THREE.MeshLambertMaterial(a)}return this.material},aa.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"init_from":this.init_from=c.textContent;break;case"format":this.format=c.textContent;break;default:console.log("unhandled Surface prop: "+c.nodeName)}}return this},ba.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"source":this.source=c.textContent;break;case"minfilter":this.minfilter=c.textContent;break;case"magfilter":this.magfilter=c.textContent;break;case"mipfilter":this.mipfilter=c.textContent;break;case"wrap_s":this.wrap_s=c.textContent;break;case"wrap_t":this.wrap_t=c.textContent;break;default:console.log("unhandled Sampler2D prop: "+c.nodeName)}}return this},ca.prototype.create=function(){return null===this.shader?null:void 0},ca.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),ya(this,a),this.shader=null;for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(c))}}return this},ca.prototype.parseNewparam=function(a){for(var b=a.getAttribute("sid"),c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"surface":this.surface[b]=new aa(this).parse(d);break;case"sampler2D":this.sampler[b]=new ba(this).parse(d);break;case"extra":break;default:console.log(d.nodeName)}}},ca.prototype.parseProfileCOMMON=function(a){for(var b,c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"profile_COMMON":this.parseProfileCOMMON(d);break;case"technique":b=d;break;case"newparam":this.parseNewparam(d);break;case"image":var e=(new F).parse(d);Ta[e.id]=e;break;case"extra":break;default:console.log(d.nodeName)}}return b},ca.prototype.parseTechnique=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new _(c.nodeName,this).parse(c);break;case"extra":this.parseExtra(c)}}},ca.prototype.parseExtra=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"technique":this.parseExtraTechnique(c)}}},ca.prototype.parseExtraTechnique=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"bump":this.shader.parse(a)}}},da.prototype.parse=function(a){return this.url=a.getAttribute("url").replace(/^#/,""),this},ea.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.source={};for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"animation":var d=(new ea).parse(c);for(var e in d.source)this.source[e]=d.source[e];for(var f=0;f<d.channel.length;f++)this.channel.push(d.channel[f]),this.sampler.push(d.sampler[f]);break;case"source":var e=(new Y).parse(c);this.source[e.id]=e;break;case"sampler":this.sampler.push(new ga(this).parse(c));break;case"channel":this.channel.push(new fa(this).parse(c))}}return this},fa.prototype.parse=function(a){this.source=a.getAttribute("source").replace(/^#/,""),this.target=a.getAttribute("target");var b=this.target.split("/"),c=(b.shift(),b.shift()),d=c.indexOf(".")>=0,e=c.indexOf("(")>=0;if(d)b=c.split("."),this.sid=b.shift(),this.member=b.shift();else if(e){var f=c.split("(");this.sid=f.shift();for(var g=0;g<f.length;g++)f[g]=parseInt(f[g].replace(/\)/,""));this.arrIndices=f}else this.sid=c;return this.fullSid=c,this.dotSyntax=d,this.arrSyntax=e,this},ga.prototype.parse=function(a){this.id=a.getAttribute("id"),this.inputs=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"input":this.inputs.push((new X).parse(c))}}return this},ga.prototype.create=function(){for(var a=0;a<this.inputs.length;a++){var b=this.inputs[a],c=this.animation.source[b.source];switch(b.semantic){case"INPUT":this.input=c.read();break;case"OUTPUT":this.output=c.read(),this.strideOut=c.accessor.stride;break;case"INTERPOLATION":this.interpolation=c.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(b.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var a=0;a<this.input.length;a++)this.startTime=Math.min(this.startTime,this.input[a]),this.endTime=Math.max(this.endTime,this.input[a]);this.duration=this.endTime-this.startTime}},ga.prototype.getData=function(a,b,c){var d;if("matrix"===a&&16===this.strideOut)d=this.output[b];else if(this.strideOut>1){d=[],b*=this.strideOut;for(var e=0;e<this.strideOut;++e)d[e]=this.output[b+e];if(3===this.strideOut)switch(a){case"rotate":case"translate":Aa(d,-1);break;case"scale":Aa(d,1)}else 4===this.strideOut&&"matrix"===a&&Aa(d,-1)}else d=this.output[b],c&&"translate"===a&&(d=Ba(c,d));return d},ha.prototype.addTarget=function(a,b,c,d){this.targets.push({sid:a,member:c,transform:b,data:d})},ha.prototype.apply=function(a){for(var b=0;b<this.targets.length;++b){var c=this.targets[b];a&&c.sid!==a||c.transform.update(c.data,c.member)}},ha.prototype.getTarget=function(a){for(var b=0;b<this.targets.length;++b)if(this.targets[b].sid===a)return this.targets[b];return null},ha.prototype.hasTarget=function(a){for(var b=0;b<this.targets.length;++b)if(this.targets[b].sid===a)return!0;return!1},ha.prototype.interpolate=function(a,b){for(var c=0,d=this.targets.length;d>c;c++){var e,f=this.targets[c],g=a.getTarget(f.sid);if("matrix"!==f.transform.type&&g){var h=(b-this.time)/(a.time-this.time),i=g.data,j=f.data;if(0>h&&(h=0),h>1&&(h=1),j.length){e=[];for(var k=0;k<j.length;++k)e[k]=j[k]+(i[k]-j[k])*h}else e=j+(i-j)*h}else e=f.data;f.transform.update(e,f.member)}},ia.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"optics":this.parseOptics(c)}}return this},ia.prototype.parseOptics=function(a){for(var b=0;b<a.childNodes.length;b++)if("technique_common"===a.childNodes[b].nodeName)for(var c=a.childNodes[b],d=0;d<c.childNodes.length;d++)if(this.technique=c.childNodes[d].nodeName,"perspective"===this.technique)for(var e=c.childNodes[d],f=0;f<e.childNodes.length;f++){var g=e.childNodes[f];switch(g.nodeName){case"yfov":this.yfov=g.textContent;break;case"xfov":this.xfov=g.textContent;break;case"znear":this.znear=g.textContent;break;case"zfar":this.zfar=g.textContent;break;case"aspect_ratio":this.aspect_ratio=g.textContent}}else if("orthographic"===this.technique)for(var h=c.childNodes[d],f=0;f<h.childNodes.length;f++){var g=h.childNodes[f];switch(g.nodeName){case"xmag":this.xmag=g.textContent;break;case"ymag":this.ymag=g.textContent;break;case"znear":this.znear=g.textContent;break;case"zfar":this.zfar=g.textContent;break;case"aspect_ratio":this.aspect_ratio=g.textContent}}return this},ja.prototype.parse=function(a){return this.url=a.getAttribute("url").replace(/^#/,""),this},ka.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"technique_common":this.parseCommon(c);break;case"technique":this.parseTechnique(c)}}return this},ka.prototype.parseCommon=function(a){for(var b=0;b<a.childNodes.length;b++)switch(a.childNodes[b].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=a.childNodes[b].nodeName;for(var c=a.childNodes[b],d=0;d<c.childNodes.length;d++){var e=c.childNodes[d];switch(e.nodeName){case"color":var f=sa(e.textContent);this.color=new THREE.Color(0),this.color.setRGB(f[0],f[1],f[2]),this.color.a=f[3];break;case"falloff_angle":this.falloff_angle=parseFloat(e.textContent);break;case"quadratic_attenuation":var g=parseFloat(e.textContent);this.distance=g?Math.sqrt(1/g):0}}}return this},ka.prototype.parseTechnique=function(a){this.profile=a.getAttribute("profile");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"intensity":this.intensity=parseFloat(c.textContent)}}return this},la.prototype.parse=function(a){return this.url=a.getAttribute("url").replace(/^#/,""),this},ma.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),this.joints=[],this.links=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"technique_common":this.parseCommon(c)}}return this},ma.prototype.parseCommon=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(a.childNodes[b].nodeName){case"joint":this.joints.push((new na).parse(c));break;case"link":this.links.push((new oa).parse(c))}}return this},na.prototype.parse=function(a){this.sid=a.getAttribute("sid"),this.name=a.getAttribute("name"),this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this["static"]=!1,this.zeroPosition=0,this.middlePosition=0;var b=a.querySelector("axis"),c=sa(b.textContent);this.axis=Ca(c,0);var d=a.querySelector("limits min")?parseFloat(a.querySelector("limits min").textContent):-360,e=a.querySelector("limits max")?parseFloat(a.querySelector("limits max").textContent):360;this.limits={min:d,max:e};for(var f=["prismatic","revolute"],g=0;g<f.length;g++){var h=f[g],i=a.querySelector(h);i&&(this.type=h)}return this.limits.min>=this.limits.max&&(this["static"]=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},oa.prototype.parse=function(a){this.sid=a.getAttribute("sid"),this.name=a.getAttribute("name"),this.transforms=[],this.attachments=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"attachment_full":this.attachments.push((new pa).parse(c));break;case"rotate":case"translate":case"matrix":this.transforms.push((new L).parse(c))}}return this},pa.prototype.parse=function(a){this.joint=a.getAttribute("joint").split("/").pop(),this.links=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"link":this.links.push((new oa).parse(c));break;case"rotate":case"translate":case"matrix":this.transforms.push((new L).parse(c))}}return this},{load:a,parse:b,setPreferredShading:c,applySkin:r,geometries:Wa,options:ab}};